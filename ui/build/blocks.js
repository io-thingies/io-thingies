"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var BootstrappEntity=function(){function BootstrappEntity(id){_classCallCheck(this,BootstrappEntity);this.id=id;this.data=new Map;this.requiredActions=new Set(["constructor","getCode","get","listSubTypes","listAllSubTypes","listActions","listAllActions","listBehaviors","listAllBehaviors","lisAncestors","addSuperType","listSuperTypes"])}_createClass(BootstrappEntity,[{key:"REQUIRE",value:function REQUIRE(test,msg){console.assert(test,msg)}},{key:"_getAction",value:function _getAction(action){return this[action]}},{key:"_deleteAction",value:function _deleteAction(action){if(this[action]&&!this.requiredActions.has(action)&&!action.startsWith("_")){var p=Object.getPrototypeOf(this);delete p[action];this.log("removed bootstrap action: "+action);this._logActions()}}},{key:"_logActions",value:function _logActions(){var functions=Object.getOwnPropertyNames(Object.getPrototypeOf(this));var result="";var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=functions[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var f=_step.value;if(f!="constructor"&&f!="REQUIRE"&&!f.startsWith("_")){result+=f+", "}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}this.log("bootstrap actions: "+result)}},{key:"log",value:function log(msg){console.log(msg)}},{key:"execute",value:function execute(action,param,extraParams){var thisInstance=BootstrappEntity.thisInstance;thisInstance.REQUIRE(thisInstance!=null,"This instance has not been bootstrapped.");var doExecute=true;var prePostExecute=action=="preExecute"||action=="postExecute"||action=="listActions"||action=="getCode";if(!prePostExecute){try{doExecute=thisInstance.executeAction.bind(this)("preExecute",{action:action,param:param})}catch(e){}}var result=void 0;try{result=thisInstance.executeAction.bind(this)(action,param,extraParams)}catch(error){try{doExecute=thisInstance.executeAction.bind(this)("errorExecute",{action:action,param:param,error:error})}catch(e){}throw error}if(!prePostExecute){try{return thisInstance.executeAction.bind(this)("postExecute",{action:action,param:param,result:result})}catch(e){}}return result}},{key:"executeAction",value:function executeAction(action,param,extraParams){var thisInstance=BootstrappEntity.thisInstance;var output=void 0;var actionCode=thisInstance._getAction(action);if(actionCode){output=actionCode.bind(this)(param,extraParams);return output}var allActions=thisInstance.listAllActions.bind(this)();if(allActions&&allActions.has(action)){var actionInstances=allActions.get(action);var _output=void 0;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=actionInstances[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var actionInstance=_step2.value;var _actionCode=actionInstance.execute("getCode");if(_actionCode){_output=_actionCode.bind(this)(param,_output,extraParams)}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return _output}throw"ACTION_NOT_FOUND: "+action}},{key:"new",value:function _new(param){var thisInstance=BootstrappEntity.thisInstance;var newInstance=new CoreBuildingBlock(param);thisInstance.addSuperType.bind(newInstance)(this);thisInstance.add.bind(this)(newInstance);thisInstance.data[param]=newInstance;return newInstance}},{key:"get",value:function get(id){var thisInstance=BootstrappEntity.thisInstance;return thisInstance.data[id]}},{key:"getBaseType",value:function getBaseType(){var thisInstance=BootstrappEntity.thisInstance;var ancestors=thisInstance.listAncestors.bind(this)().toArray();var pos=0;if(ancestors.length>1){pos=Math.max(1,ancestors.length-3)}var baseType=ancestors[pos];return baseType}},{key:"setCode",value:function setCode(param){var thisInstance=BootstrappEntity.thisInstance;thisInstance.REQUIRE(thisInstance!=null,"Cannot auto link setCode without bootstrap support.");if(param==null){param=thisInstance._getAction(this.id)}this.data.set("code",param)}},{key:"getCode",value:function getCode(){return this.data.get("code")}},{key:"_addToList",value:function _addToList(param,typeValue){var thisInstance=BootstrappEntity.thisInstance;var typeValues=this.data.get(typeValue);if(typeValues==null){typeValues=new BuildingBlockMap;this.data.set(typeValue,typeValues)}typeValues.set(param.id,param);this.data.set(typeValue,typeValues)}},{key:"add",value:function add(param){var thisInstance=BootstrappEntity.thisInstance;thisInstance._addToList.bind(this)(param,"instances")}},{key:"addBehavior",value:function addBehavior(param){var thisInstance=BootstrappEntity.thisInstance;thisInstance.REQUIRE(thisInstance._checkAncestors.bind(param)("behaviorType"),"addBehavior requires a Behavior parameter.");thisInstance._addToList.bind(this)(param,"behaviors")}},{key:"addAction",value:function addAction(param){var thisInstance=BootstrappEntity.thisInstance;thisInstance.REQUIRE(thisInstance._checkAncestors.bind(param)("actionType"),"addAction requires an Action parameter.");thisInstance._addToList.bind(this)(param,"actions");thisInstance._deleteAction(param.id)}},{key:"addSuperType",value:function addSuperType(param){var thisInstance=BootstrappEntity.thisInstance;thisInstance._addToList.bind(this)(param,"superTypes");thisInstance.add.bind(param)(this)}},{key:"listSubTypes",value:function listSubTypes(){return this.data.get("instances")}},{key:"listBehaviors",value:function listBehaviors(param){var behaviors=this.data.get("behaviors");if(param){var _ret=function(){var result=new BuildingBlockMap;if(behaviors){behaviors.forEach(function(value,key){var superTypes=value.execute("listSuperTypes");if(superTypes.has(param)){result.set(value.id,value)}})}return{v:result}}();if((typeof _ret==="undefined"?"undefined":_typeof(_ret))==="object")return _ret.v}else{return behaviors}}},{key:"listBehaviorGroups",value:function listBehaviorGroups(){var result=new BuildingBlockMap;var behaviors=this.data.get("behaviors");if(behaviors){behaviors.forEach(function(value,key){var superTypes=value.execute("listSuperTypes");result=BuildingBlockMap.mergeMaps(result,superTypes)})}return result}},{key:"listActions",value:function listActions(){return this.data.get("actions")}},{key:"listSuperTypes",value:function listSuperTypes(){return this.data.get("superTypes")}},{key:"listAllSubTypes",value:function listAllSubTypes(processor){var thisInstance=BootstrappEntity.thisInstance;var result=new BuildingBlockMap;var instances=thisInstance.listSubTypes.bind(this)();if(instances&&instances.size>0){var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=instances.values()[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var instance=_step3.value;var foundInstance=instance;if(processor){thisInstance.REQUIRE(processor.execute!=null,"The processor must have an execute().");foundInstance=processor.execute("applyFilter",instance)}if(foundInstance){result.set(foundInstance.id,foundInstance)}var subInstances=thisInstance.listAllSubTypes.bind(instance)(processor);result=BuildingBlockMap.mergeMaps(result,subInstances)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}return result}},{key:"_checkAncestors",value:function _checkAncestors(param){var thisInstance=BootstrappEntity.thisInstance;var paramParent=thisInstance.listAncestors.bind(this)();return paramParent.has(param)}},{key:"listAncestors",value:function listAncestors(){var thisInstance=BootstrappEntity.thisInstance;var ancestors=new BuildingBlockMap;var toProcess=[this];while(toProcess.length){var instance=toProcess.shift();ancestors.set(instance.id,instance);var directSuperTypes=thisInstance.listSuperTypes.bind(instance)();if(directSuperTypes){directSuperTypes.forEach(function(value,key){toProcess.push(value)})}}return ancestors}},{key:"listAllBehaviors",value:function listAllBehaviors(param){var thisInstance=BootstrappEntity.thisInstance;var behaviors=void 0;var ancestors=thisInstance.listAncestors.bind(this)().toArray();for(var i=ancestors.length-1;i>=0;i--){var parentBehaviors=thisInstance.listBehaviors.bind(ancestors[i])(param);behaviors=BuildingBlockMap.mergeMaps(behaviors,parentBehaviors)}return behaviors}},{key:"listAllActions",value:function listAllActions(){var thisInstance=BootstrappEntity.thisInstance;var behaviors=thisInstance.listAllBehaviors.bind(this)();var actions=void 0;if(behaviors){var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=behaviors.values()[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var bInstance=_step4.value;var bActions=thisInstance.listActions.bind(bInstance)();actions=BuildingBlockListMap.mergeMaps(actions,bActions)}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}return actions}},{key:"getJSON",value:function getJSON(param){var thisInstance=BootstrappEntity.thisInstance;var result={id:this.id,behaviors:[]};var behaviors=this.execute("listAllBehaviors");var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=behaviors.values()[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var b=_step5.value;var serializer=thisInstance.execute.bind(b)("getCode");if(serializer){var s=serializer.bind(this)();if(s){result.behaviors.push(s)}}else{throw this.id+" missing serializer for "+b.id}}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return()}}finally{if(_didIteratorError5){throw _iteratorError5}}}return JSON.stringify(result,null,param)}},{key:"setJSON",value:function setJSON(json){var thisInstance=BootstrappEntity.thisInstance;var result=this.execute("new",json.id);var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=json.behaviors[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var behaviorData=_step6.value;var behavior=this.execute("get",behaviorData.id);var serializer=thisInstance.execute.bind(behavior)("getCode");if(serializer){serializer.bind(result)(behaviorData)}else{throw result.id+" missing serializer for "+behaviorData.id}}}catch(err){_didIteratorError6=true;_iteratorError6=err}finally{try{if(!_iteratorNormalCompletion6&&_iterator6.return){_iterator6.return()}}finally{if(_didIteratorError6){throw _iteratorError6}}}return result}}],[{key:"getInstance",value:function getInstance(){BootstrappEntity.thisInstance=BootstrappEntity.thisInstance||new BootstrappEntity("v1");return BootstrappEntity.thisInstance}}]);return BootstrappEntity}();var BuildingBlockListMap=function(){function BuildingBlockListMap(){_classCallCheck(this,BuildingBlockListMap);this.map=new Map}_createClass(BuildingBlockListMap,[{key:"add",value:function add(k,v){var map=this.map.get(k);if(map==null){map=new Array;this.set(k,map)}map.push(v)}},{key:"set",value:function set(k,v){this.map.set(k,v)}},{key:"get",value:function get(k){return this.map.get(k)}},{key:"getAt",value:function getAt(k,i){return this.map.get(k)[i]}},{key:"has",value:function has(k){return this.map.has(k)&&this.map.get(k).length>0}},{key:"delete",value:function _delete(k,i){if(i==null){return this.map.delete(k)}else{return delete this.map.get(k)[i]}}},{key:"values",value:function values(){return this.map.values()}},{key:"forEach",value:function forEach(callbackfn,thisArg){this.map.forEach(callbackfn,thisArg)}},{key:"length",value:function length(k){return this.map.get(k).length}},{key:"toJSON",value:function toJSON(){return Array.from(this.map.keys())}},{key:"size",get:function get(){return this.map.size}}],[{key:"mergeMaps",value:function mergeMaps(map1,map2){if(map1){if(map2){var _ret2=function(){var newMap=new BuildingBlockListMap;map1.forEach(function(value,key){newMap.set(key,value)});map2.forEach(function(value,key){newMap.add(key,value)});return{v:newMap}}();if((typeof _ret2==="undefined"?"undefined":_typeof(_ret2))==="object")return _ret2.v}else{return map1}}else if(map2){var _ret3=function(){var newMap=new BuildingBlockListMap;map2.forEach(function(value,key){newMap.add(key,value)});return{v:newMap}}();if((typeof _ret3==="undefined"?"undefined":_typeof(_ret3))==="object")return _ret3.v}return null}}]);return BuildingBlockListMap}();var BuildingBlockMap=function(){function BuildingBlockMap(){_classCallCheck(this,BuildingBlockMap);this.map=new Map}_createClass(BuildingBlockMap,[{key:"set",value:function set(k,v){this.map.set(k,v)}},{key:"get",value:function get(k){return this.map.get(k)}},{key:"has",value:function has(k){return this.map.has(k)}},{key:"delete",value:function _delete(k){return this.map.delete(k)}},{key:"keys",value:function keys(){return this.map.keys()}},{key:"values",value:function values(){return this.map.values()}},{key:"forEach",value:function forEach(callbackfn,thisArg){this.map.forEach(callbackfn,thisArg)}},{key:"toJSON",value:function toJSON(){return Array.from(this.map.keys())}},{key:"toArray",value:function toArray(){return Array.from(this.map.values())}},{key:"size",get:function get(){return this.map.size}}],[{key:"mergeMaps",value:function mergeMaps(map1,map2){var overwrite=arguments.length<=2||arguments[2]===undefined?true:arguments[2];if(map1){if(map2){var _ret4=function(){var newMap=new BuildingBlockMap;map1.forEach(function(value,key){newMap.set(key,value)});map2.forEach(function(value,key){if(overwrite||!overwrite&&!newMap.has(key)){newMap.set(key,value)}});return{v:newMap}}();if((typeof _ret4==="undefined"?"undefined":_typeof(_ret4))==="object")return _ret4.v}else{return map1}}else if(map2){return map2}return null}}]);return BuildingBlockMap}();var BuildingBlockReference=function(){function BuildingBlockReference(entity,tag){var inherited=arguments.length<=2||arguments[2]===undefined?false:arguments[2];var baseEntity=arguments[3];var baseReference=arguments[4];_classCallCheck(this,BuildingBlockReference);this.entity=entity;this.tag=tag;this.inherited=inherited;this.baseEntity=baseEntity;this.baseReference=baseReference}_createClass(BuildingBlockReference,[{key:"execute",value:function execute(action,param){var _entity;for(var _len=arguments.length,extraParams=Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){extraParams[_key-2]=arguments[_key]}return(_entity=this.entity).execute.apply(_entity,[action,param].concat(extraParams))}},{key:"id",get:function get(){return this.entity.id}},{key:"data",get:function get(){return this.entity.data}}]);return BuildingBlockReference}();"use strict";var BuiltInBlocks=function(){function BuiltInBlocks(){_classCallCheck(this,BuiltInBlocks);this.types={};this.options={}}_createClass(BuiltInBlocks,[{key:"init",value:function init(options){this.options=options;this.rootType=new CoreBuildingBlock(".guest-root");this.initCore();this.initRelations();this.initAlias();this.initList();this.initActionable();this.initIdentity();this.initPersistence();this.initSerialization();this.initPresentation();this.initFinder();this.playground()}},{key:"ext",value:function ext(options){}},{key:"initCore",value:function initCore(){var coreType=this.rootType.execute("new","coreType");var behaviorType=coreType.execute("new","behaviorType");var actionType=coreType.execute("new","actionType");var entityType=coreType.execute("new","entityType");this.types={coreType:coreType,behaviorType:behaviorType,actionType:actionType,entityType:entityType};if(this.options&&this.options.log){this.initConsoleLog()}var hasBehaviors=behaviorType.execute("new","hasBehaviors");var hasActions=behaviorType.execute("new","hasActions");var isActionable=behaviorType.execute("new","isActionable");this.rootType.execute("addBehavior",hasBehaviors);behaviorType.execute("addBehavior",hasActions);actionType.execute("addBehavior",isActionable);var addBehavior=actionType.execute("new","addBehavior");var removeBehavior=actionType.execute("new","removeBehavior");var listBehaviors=actionType.execute("new","listBehaviors");var listAllBehaviors=actionType.execute("new","listAllBehaviors");var listBehaviorGroups=actionType.execute("new","listBehaviorGroups");var listAllBehaviorGroups=actionType.execute("new","listAllBehaviorGroups");var addAction=actionType.execute("new","addAction");var removeAction=actionType.execute("new","removeAction");var listActions=actionType.execute("new","listActions");var listAllActions=actionType.execute("new","listAllActions");var setCode=actionType.execute("new","setCode");var getCode=actionType.execute("new","getCode");var newEntity=actionType.execute("new","new");newEntity.execute("setCode");setCode.execute("setCode");getCode.execute("setCode");addAction.execute("setCode");listActions.execute("setCode");listAllActions.execute("setCode");addBehavior.execute("setCode");listBehaviors.execute("setCode");listAllBehaviors.execute("setCode");removeAction.execute("setCode",function(param){var thisInstance=BootstrappEntity.getInstance();var actions=this.data.get("actions");actions.delete(param)});removeBehavior.execute("setCode",function(param){var thisInstance=BootstrappEntity.getInstance();var behaviors=this.data.get("behaviors");behaviors.delete(param)});listBehaviorGroups.execute("setCode",function(param){var result=new BuildingBlockMap;var behaviors=this.data.get("behaviors");if(behaviors){behaviors.forEach(function(value,key){var superTypes=value.execute("listSuperTypes");result=BuildingBlockMap.mergeMaps(result,superTypes)})}return result});listAllBehaviorGroups.execute("setCode",function(){var result=new BuildingBlockMap;var behaviors=this.execute("listAllBehaviors");if(behaviors){behaviors.forEach(function(value,key){var superTypes=value.execute("listSuperTypes");result=BuildingBlockMap.mergeMaps(result,superTypes)})}return result});hasBehaviors.execute("addAction",newEntity);hasBehaviors.execute("addAction",addBehavior);hasBehaviors.execute("addAction",removeBehavior);hasBehaviors.execute("addAction",listBehaviors);hasBehaviors.execute("addAction",listAllBehaviors);hasBehaviors.execute("addAction",listBehaviorGroups);hasBehaviors.execute("addAction",listAllBehaviorGroups);hasActions.execute("addAction",addAction);hasActions.execute("addAction",removeAction);hasActions.execute("addAction",listActions);hasActions.execute("addAction",listAllActions);isActionable.execute("addAction",setCode);isActionable.execute("addAction",getCode);var logs=this.types.logs;this.types={coreType:coreType,behaviorType:behaviorType,actionType:actionType,entityType:entityType,hasBehaviors:hasBehaviors,hasActions:hasActions,isActionable:isActionable,addBehavior:addBehavior,listBehaviors:listBehaviors,setCode:setCode,getCode:getCode,listAllBehaviors:listAllBehaviors,listBehaviorGroups:listBehaviorGroups,listAllBehaviorGroups:listAllBehaviorGroups,addAction:addAction,listActions:listActions,listAllActions:listAllActions,logs:logs,newEntity:newEntity,removeAction:removeAction,removeBehavior:removeBehavior}}},{key:"initRelations",value:function initRelations(){var _types=this.types;var coreType=_types.coreType;var behaviorType=_types.behaviorType;var actionType=_types.actionType;var entityType=_types.entityType;var referenceType=coreType.execute("new","referenceType");var component=referenceType.execute("new","component");var property=referenceType.execute("new","property");var system=referenceType.execute("new","system");var relationType=behaviorType.execute("new","relationType");var isA=relationType.execute("new","isA");var has=relationType.execute("new","has");var canBeA=relationType.execute("new","canBeA");var addSuperType=actionType.execute("new","addSuperType");var removeSuperType=actionType.execute("new","removeSuperType");var listSuperTypes=actionType.execute("new","listSuperTypes");var listSubTypes=actionType.execute("new","listSubTypes");var removeSubType=actionType.execute("new","removeSubType");var newReference=actionType.execute("new","newReference");var addReference=actionType.execute("new","addReference");var removeReference=actionType.execute("new","removeReference");var getReference=actionType.execute("new","getReference");var listReferences=actionType.execute("new","listReferences");var updateReference=actionType.execute("new","updateReference");addSuperType.execute("setCode");listSuperTypes.execute("setCode");removeSuperType.execute("setCode",function(param){var superTypes=this.data.get("superTypes");superTypes.delete(param)});listSubTypes.execute("setCode",function(){return this.data.get("instances")});removeSubType.execute("setCode",function(param){var superTypes=this.data.get("instances");superTypes.delete(param)});newReference.execute("setCode",function(tag,output,params){var _ref=params||[];var _ref2=_slicedToArray(_ref,3);var _ref2$=_ref2[0];var inherited=_ref2$===undefined?false:_ref2$;var _ref2$2=_ref2[1];var baseEntity=_ref2$2===undefined?null:_ref2$2;var _ref2$3=_ref2[2];var baseReference=_ref2$3===undefined?null:_ref2$3;return new BuildingBlockReference(this,tag,inherited,baseEntity,baseReference)});addReference.execute("setCode",function(entity,output,params){var thisInstance=BootstrappEntity.getInstance();var references=this.data.get("references");if(references==null){references=new BuildingBlockMap;this.data.set("references",references)}if(entity instanceof BuildingBlockReference){references.set(entity.id,entity)}else{thisInstance.REQUIRE(params&&params.length,"addReference requires a tag parameter.");var ref=entity.execute("newReference",params[0]);references.set(entity.id,ref)}});removeReference.execute("setCode",function(entityId){var references=this.data.get("references");references.delete(entityId)});getReference.execute("setCode",function(id){var thisInstance=BootstrappEntity.getInstance();var aggregatedRefs=this.execute("listReferences");var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=aggregatedRefs.values()[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var ref=_step7.value;if(ref.id==id){return ref}var instance=ref;var refInst=void 0;while(instance){if(refInst){var references=instance.data.get("references");if(references){instance=references.get(refInst.id)}}refInst=instance.baseReference||instance;if(refInst&&refInst.id==id){return ref}instance=instance.baseEntity}}}catch(err){_didIteratorError7=true;_iteratorError7=err}finally{try{if(!_iteratorNormalCompletion7&&_iterator7.return){_iterator7.return()}}finally{if(_didIteratorError7){throw _iteratorError7}}}return null});listReferences.execute("setCode",function(tag){var allReferences=new BuildingBlockMap;var overwrittenReferences=new BuildingBlockMap;var references=this.data.get("references");if(tag){if(references){references.forEach(function(entityRef,key){if(entityRef.tag==tag){allReferences.set(key,entityRef);if(entityRef.baseReference){overwrittenReferences.set(entityRef.baseReference.id,entityRef)}}})}else{return null}}else if(references){references.forEach(function(entityRef,key){allReferences.set(key,entityRef);if(entityRef.baseReference){overwrittenReferences.set(entityRef.baseReference.id,entityRef)}})}var superTypes=this.execute("listSuperTypes");if(superTypes){(function(){var allParentReferences=new BuildingBlockMap;superTypes.forEach(function(parent,key){var parentReferences=parent.execute("listReferences",tag);if(parentReferences){parentReferences.forEach(function(entityRef,key){if(!entityRef.inherited){entityRef=new BuildingBlockReference(entityRef.entity,entityRef.tag,true,parent)}if(entityRef.baseReference){overwrittenReferences.set(entityRef.baseReference.id,entityRef)}if(!overwrittenReferences.has(entityRef.id)){allParentReferences.set(entityRef.id,entityRef)}else{}})}});if(allParentReferences.size){allReferences=BuildingBlockMap.mergeMaps(allReferences,allParentReferences,false)}})()}return allReferences});updateReference.execute("setCode",function(entity){var thisInstance=BootstrappEntity.getInstance();var references=this.data.get("references");if(references==null){references=new BuildingBlockMap;this.data.set("references",references)}references.set(entity.id,entity)});isA.execute("addAction",addSuperType);isA.execute("addAction",removeSuperType);isA.execute("addAction",listSuperTypes);isA.execute("addAction",removeSubType);has.execute("addAction",addReference);has.execute("addAction",removeReference);has.execute("addAction",getReference);has.execute("addAction",listReferences);has.execute("addAction",updateReference);has.execute("addAction",newReference);canBeA.execute("addAction",listSubTypes);this.rootType.execute("addBehavior",isA);this.rootType.execute("addBehavior",has);this.rootType.execute("addBehavior",canBeA);var rels=this.rootType.execute("listBehaviors","relationType");this.types.relationType=relationType;this.types.isA=isA;this.types.has=has;this.types.canBeA=canBeA;this.types.addSuperType=addSuperType;this.types.removeSuperType=removeSuperType;this.types.listSuperTypes=listSuperTypes;this.types.listSubTypes=listSubTypes;this.types.referenceType=referenceType;this.types.property=property;this.types.component=component;this.types.system=system;this.types.addReference=addReference;this.types.removeReference=removeReference;this.types.getReference=getReference;this.types.listReferences=listReferences;this.types.updateReference=updateReference;this.types.newReference=newReference}},{key:"initAlias",value:function initAlias(){var _types2=this.types;var actionType=_types2.actionType;var behaviorType=_types2.behaviorType;var hasAlias=behaviorType.execute("new","hasAlias");var newAlias=actionType.execute("new","newAlias");var isAlias=actionType.execute("new","isAlias");newAlias.execute("setCode",function(param){var bootstrappEntity=BootstrappEntity;var thisInstance=bootstrappEntity.thisInstance;var newInstance=new CoreBuildingBlock(param);newInstance.data=this.data;newInstance._id=this.id;newInstance._execute=newInstance.execute;thisInstance.data[param]=newInstance;newInstance.execute=function(action,param){for(var _len2=arguments.length,extraParams=Array(_len2>2?_len2-2:0),_key2=2;_key2<_len2;_key2++){extraParams[_key2-2]=arguments[_key2]}var result=this._execute.apply(this,[action,param].concat(extraParams));if(action=="getAliasName"&&param!="original"){return this.aliasName}else if(action=="setAliasName"){this.aliasName=param}else if(action=="getName"){var fullName=result||this._id;var aliasName=this.aliasName||this.id;if(aliasName){fullName+=" as "+aliasName}return fullName}return result};return newInstance});isAlias.execute("setCode",function(){return this._id!=null});this.rootType.execute("addBehavior",hasAlias);hasAlias.execute("addAction",newAlias);this.types.newAlias=newAlias;this.types.isAlias=isAlias;this.types.hasAlias=hasAlias}},{key:"initList",value:function initList(){var _types3=this.types;var coreType=_types3.coreType;var behaviorType=_types3.behaviorType;var actionType=_types3.actionType;var entityType=_types3.entityType;var referenceType=_types3.referenceType;var system=_types3.system;var listType=coreType.execute("new","listType");var template=this.rootType.execute("newAlias","template");var hasTemplate=behaviorType.execute("new","hasTemplate");listType.execute("addReference",template,system);listType.execute("addBehavior",hasTemplate);var addReference=actionType.execute("new","addReference");addReference.execute("setCode",function(entity){var thisInstance=BootstrappEntity.getInstance();var templateEntity=this.execute("getReference","template");thisInstance.REQUIRE(thisInstance._checkAncestors.bind(entity)(templateEntity.id),"listType.addReference requires an Entity parameter of type: "+templateEntity.id+".")});hasTemplate.execute("addAction",addReference);this.types.listType=listType;this.types.template=template;this.types.hasTemplate=hasTemplate}},{key:"setupAction",value:function setupAction(actionParam,actionMethodParam,actionTopicParam){var _types4=this.types;var actionType=_types4.actionType;var component=_types4.component;var actionMethod=_types4.actionMethod;var actionTopic=_types4.actionTopic;actionParam.execute("updateReference",actionMethodParam.execute("newReference",component,false,actionType,actionMethod));actionParam.execute("updateReference",actionTopicParam.execute("newReference",component,false,actionType,actionTopic))}},{key:"initActionable",value:function initActionable(){var _types5=this.types;var entityType=_types5.entityType;var actionType=_types5.actionType;var component=_types5.component;var addBehavior=_types5.addBehavior;var removeBehavior=_types5.removeBehavior;var listBehaviors=_types5.listBehaviors;var listAllBehaviors=_types5.listAllBehaviors;var listBehaviorGroups=_types5.listBehaviorGroups;var addAction=_types5.addAction;var removeAction=_types5.removeAction;var listActions=_types5.listActions;var listAllActions=_types5.listAllActions;var addSuperType=_types5.addSuperType;var removeSuperType=_types5.removeSuperType;var listSuperTypes=_types5.listSuperTypes;var listSubTypes=_types5.listSubTypes;var newReference=_types5.newReference;var addReference=_types5.addReference;var getReference=_types5.getReference;var listReferences=_types5.listReferences;var updateReference=_types5.updateReference;var newAlias=_types5.newAlias;var isAlias=_types5.isAlias;var actionMethod=entityType.execute("new","actionMethod");var actionGetMethod=actionMethod.execute("new","actionGetMethod");var actionSetMethod=actionMethod.execute("new","actionSetMethod");var actionListMethod=actionMethod.execute("new","actionListMethod");var actionAddMethod=actionMethod.execute("new","actionAddMethod");var actionNewMethod=actionMethod.execute("new","actionNewMethod");var actionUpdateMethod=actionMethod.execute("new","actionUpdateMethod");var actionIsMethod=actionMethod.execute("new","actionIsMethod");var actionDeleteMethod=actionMethod.execute("new","actionDeleteMethod");var actionRemoveMethod=actionMethod.execute("new","actionRemoveMethod");var actionTopic=entityType.execute("new","actionTopic");var actionTopicAction=actionTopic.execute("new","actionTopicAction");var actionTopicBehavior=actionTopic.execute("new","actionTopicBehavior");var actionTopicEntity=actionTopic.execute("new","actionTopicEntity");actionType.execute("addReference",actionMethod,component);actionType.execute("addReference",actionTopic,component);this.types.actionMethod=actionMethod;this.types.actionTopic=actionTopic;var actionTopicAllActions=actionTopic.execute("new","actionTopicAllActions");var actionTopicBehaviorGroups=actionTopic.execute("new","actionTopicBehaviorGroups");var actionTopicAllBehaviorGroups=actionTopic.execute("new","actionTopicAllBehaviorGroups");var actionTopicAllBehavior=actionTopic.execute("new","actionTopicAllBehavior");var actionTopicSuperType=actionTopic.execute("new","actionTopicSuperType");var actionTopicSubTypes=actionTopic.execute("new","actionTopicSubTypes");var actionTopicAlias=actionTopic.execute("new","actionTopicAlias");var actionTopicReference=actionTopic.execute("new","actionTopicReference");this.setupAction(addBehavior,actionAddMethod,actionTopicBehavior);this.setupAction(removeBehavior,actionRemoveMethod,actionTopicBehavior);this.setupAction(listBehaviors,actionListMethod,actionTopicBehavior);this.setupAction(listAllBehaviors,actionListMethod,actionTopicAllBehavior);this.setupAction(listBehaviorGroups,actionListMethod,actionTopicAllBehaviorGroups);this.setupAction(addAction,actionAddMethod,actionTopicAction);this.setupAction(removeAction,actionRemoveMethod,actionTopicAction);this.setupAction(listActions,actionListMethod,actionTopicAction);this.setupAction(listAllActions,actionListMethod,actionTopicAllActions);this.setupAction(addSuperType,actionAddMethod,actionTopicSuperType);this.setupAction(removeSuperType,actionDeleteMethod,actionTopicSuperType);this.setupAction(listSuperTypes,actionListMethod,actionTopicAllActions);this.setupAction(listSubTypes,actionListMethod,actionTopicSubTypes);this.setupAction(newReference,actionNewMethod,actionTopicReference);this.setupAction(addReference,actionAddMethod,actionTopicReference);this.setupAction(getReference,actionGetMethod,actionTopicReference);this.setupAction(listReferences,actionListMethod,actionTopicReference);this.setupAction(updateReference,actionUpdateMethod,actionTopicReference);this.setupAction(newAlias,actionNewMethod,actionTopicAlias);this.setupAction(isAlias,actionIsMethod,actionTopicAlias);this.types.actionSetMethod=actionSetMethod;this.types.actionGetMethod=actionGetMethod;this.types.actionListMethod=actionListMethod;this.types.actionAddMethod=actionAddMethod;this.types.actionNewMethod=actionNewMethod;this.types.actionUpdateMethod=actionUpdateMethod;this.types.actionTopicAction=actionTopicAction;this.types.actionTopicBehavior=actionTopicBehavior;this.types.actionTopicEntity=actionTopicEntity;this.types.actionTopicSuperType=actionTopicSuperType;this.types.actionTopicSubTypes=actionTopicSubTypes;this.types.actionTopicAlias=actionTopicAlias;this.types.actionTopicReference=actionTopicReference}},{key:"initIdentity",value:function initIdentity(){var _types6=this.types;var coreType=_types6.coreType;var behaviorType=_types6.behaviorType;var actionType=_types6.actionType;var entityType=_types6.entityType;var hasBehaviors=_types6.hasBehaviors;var hasActions=_types6.hasActions;var isActionable=_types6.isActionable;var relationType=_types6.relationType;var isA=_types6.isA;var has=_types6.has;var canBeA=_types6.canBeA;var addBehavior=_types6.addBehavior;var listBehaviors=_types6.listBehaviors;var setCode=_types6.setCode;var getCode=_types6.getCode;var listAllBehaviors=_types6.listAllBehaviors;var addAction=_types6.addAction;var listActions=_types6.listActions;var listAllActions=_types6.listAllActions;var listBehaviorGroups=_types6.listBehaviorGroups;var listAllBehaviorGroups=_types6.listAllBehaviorGroups;var addSuperType=_types6.addSuperType;var removeSuperType=_types6.removeSuperType;var listSuperTypes=_types6.listSuperTypes;var listSubTypes=_types6.listSubTypes;var addReference=_types6.addReference;var removeReference=_types6.removeReference;var listReferences=_types6.listReferences;var getReference=_types6.getReference;var updateReference=_types6.updateReference;var newReference=_types6.newReference;var referenceType=_types6.referenceType;var property=_types6.property;var component=_types6.component;var newEntity=_types6.newEntity;var removeAction=_types6.removeAction;var removeBehavior=_types6.removeBehavior;var hasAlias=_types6.hasAlias;var isAlias=_types6.isAlias;var newAlias=_types6.newAlias;var actionMethod=_types6.actionMethod;var actionSetMethod=_types6.actionSetMethod;var actionGetMethod=_types6.actionGetMethod;var actionListMethod=_types6.actionListMethod;var actionAddMethod=_types6.actionAddMethod;var actionNewMethod=_types6.actionNewMethod;var actionUpdateMethod=_types6.actionUpdateMethod;var actionTopic=_types6.actionTopic;var actionTopicAction=_types6.actionTopicAction;var actionTopicBehavior=_types6.actionTopicBehavior;var actionTopicEntity=_types6.actionTopicEntity;var actionTopicSuperType=_types6.actionTopicSuperType;var actionTopicSubTypes=_types6.actionTopicSubTypes;var actionTopicAlias=_types6.actionTopicAlias;var actionTopicReference=_types6.actionTopicReference;var isIdentifiable=behaviorType.execute("new","isIdentifiable");this.rootType.execute("addBehavior",isIdentifiable);var setName=actionType.execute("new","setName");var getName=actionType.execute("new","getName");setName.execute("setCode",function(name){this.data.set("name",name)});getName.execute("setCode",function(){return this.data.get("name")});isIdentifiable.execute("addAction",setName);isIdentifiable.execute("addAction",getName);setName.execute("setName","Set the name");getName.execute("setName","Get the name");var actionTopicName=actionTopic.execute("new","actionTopicName");actionTopicName.execute("setName","Name");this.setupAction(setName,actionSetMethod,actionTopicName);this.setupAction(getName,actionGetMethod,actionTopicName);isIdentifiable.execute("setName","Is identifiable");this.rootType.execute("setName","System Root");coreType.execute("setName","Core Type");setCode.execute("setName","Set the code");getCode.execute("setName","Get the code");behaviorType.execute("setName","Behavior Type");actionType.execute("setName","Action Type");entityType.execute("setName","Entity Type");hasBehaviors.execute("setName","Has Behaviors");hasActions.execute("setName","Has Actions");isActionable.execute("setName","Is Actionable");addAction.execute("setName","Add Action");listActions.execute("setName","List Actions");listAllActions.execute("setName","List All Actions");addBehavior.execute("setName","Add Behavior");listBehaviors.execute("setName","List Behaviors");listAllBehaviors.execute("setName","List All Behaviors");newEntity.execute("setName","New entity");removeAction.execute("setName","Remove action");removeBehavior.execute("setName","Remove behavior");addSuperType.execute("setName","Add parent type");removeSuperType.execute("setName","Delete parent type");listSuperTypes.execute("setName","List parent types");listSubTypes.execute("setName","List sub-types");addReference.execute("setName","Add reference");removeReference.execute("setName","Remove reference");getReference.execute("setName","Get reference");listReferences.execute("setName","List references");updateReference.execute("setName","Update reference");newReference.execute("setName","New reference");referenceType.execute("setName","Reference type");property.execute("setName","Property");component.execute("setName","Component");listBehaviorGroups.execute("setName","List Behavior Groups");listAllBehaviorGroups.execute("setName","List All Behavior Groups");relationType.execute("setName","Relation Type");isA.execute("setName","Is a");has.execute("setName","Has");canBeA.execute("setName","Can be a");newAlias.execute("setName","New alias");isAlias.execute("setName","Is alias");hasAlias.execute("setName","Has alias");actionMethod.execute("setName","Method");actionSetMethod.execute("setName","Set");actionGetMethod.execute("setName","Get");actionListMethod.execute("setName","List");actionAddMethod.execute("setName","Add");actionNewMethod.execute("setName","New");actionUpdateMethod.execute("setName","Update");actionTopic.execute("setName","Topic");actionTopicAction.execute("setName","Action");actionTopicBehavior.execute("setName","Behavior");actionTopicEntity.execute("setName","Entity");actionTopicSuperType.execute("setName","Parent type");actionTopicSubTypes.execute("setName","Sub-type");actionTopicAlias.execute("setName","Alias");actionTopicReference.execute("setName","Reference");this.types.isIdentifiable=isIdentifiable}},{key:"initPersistence",value:function initPersistence(){var _types7=this.types;var coreType=_types7.coreType;var behaviorType=_types7.behaviorType;var actionType=_types7.actionType;var entityType=_types7.entityType;var listType=_types7.listType;var hasBehaviors=_types7.hasBehaviors;var hasActions=_types7.hasActions;var isActionable=_types7.isActionable;var addBehavior=_types7.addBehavior;var listBehaviors=_types7.listBehaviors;var setCode=_types7.setCode;var getCode=_types7.getCode;var listAllBehaviors=_types7.listAllBehaviors;var addAction=_types7.addAction;var listActions=_types7.listActions;var listAllActions=_types7.listAllActions;var actionNewMethod=_types7.actionNewMethod;var actionTopicEntity=_types7.actionTopicEntity;var userType=this.rootType.execute("new","userType");var entity=entityType.execute("new","entity");var behavior=behaviorType.execute("new","behavior");var action=actionType.execute("new","action");var list=listType.execute("new","list");entity.execute("addSuperType",userType);behavior.execute("addSuperType",userType);action.execute("addSuperType",userType);list.execute("addSuperType",userType);userType.execute("setName","User type");behavior.execute("setName","Behavior");action.execute("setName","Action");entity.execute("setName","Entity");var persistence=behaviorType.execute("new","persistence");var isPersistedLocally=persistence.execute("new","isPersistedLocally");var isPersistedRemotely=persistence.execute("new","isPersistedRemotely");entity.execute("addBehavior",persistence);var newEntity=action.execute("new","new");var addEntity=action.execute("new","addEntity");var setEntity=action.execute("new","setEntity");var getEntity=action.execute("new","getEntity");var listSubTypes=action.execute("new","listSubTypes");var listAllSubTypes=action.execute("new","listAllSubTypes");var postExecute=action.execute("new","postExecute");var getInfo=action.execute("new","getInfo");var setInfo=action.execute("new","setInfo");newEntity.execute("setCode",function(param,newInstance){try{newInstance.execute("setInfo",{"createdOn":new Date().getTime()})}catch(e){}return newInstance});postExecute.execute("setCode",function(params){if(params!="setInfo"&&(params.startsWith("set")||params.startsWith("add"))){params.result.execute("setInfo",{"modifiedOn":new Date().getTime()})}return params.result});getInfo.execute("setCode",function(infoType){var info=this.data.get("info");if(infoType){return info[infoType]}else{return info}});setInfo.execute("setCode",function(param){var info=this.data.get("info");if(info==null){info={};this.data.set("info",info)}Object.assign(info,param)});this.setupAction(newEntity,actionNewMethod,actionTopicEntity);persistence.execute("addAction",newEntity);persistence.execute("addAction",postExecute);persistence.execute("addAction",getInfo);persistence.execute("addAction",setInfo);persistence.execute("addAction",listSubTypes);persistence.execute("setName","Is persistent");entity.execute("setName","Entity");behavior.execute("setName","Behavior");action.execute("setName","Action");list.execute("setName","List");this.types.userType=userType;this.types.entity=entity;this.types.behavior=behavior;this.types.action=action;this.types.list=list;this.types.persistence=persistence}},{key:"initSerialization",value:function initSerialization(){var _types8=this.types;var coreType=_types8.coreType;var behaviorType=_types8.behaviorType;var actionType=_types8.actionType;var entityType=_types8.entityType;var userType=_types8.userType;var behavior=_types8.behavior;var action=_types8.action;var entity=_types8.entity;var hasBehaviors=_types8.hasBehaviors;var hasActions=_types8.hasActions;var isActionable=_types8.isActionable;var isIdentifiable=_types8.isIdentifiable;var isA=_types8.isA;var has=_types8.has;var canBeA=_types8.canBeA;var persistence=_types8.persistence;var hasTemplate=_types8.hasTemplate;var hasAlias=_types8.hasAlias;var setCode=_types8.setCode;var getCode=_types8.getCode;var logs=_types8.logs;var isSerializable=behavior.execute("new","isSerializable");var getJSON=action.execute("new","getJSON");var setJSON=action.execute("new","setJSON");getJSON.execute("setCode");setJSON.execute("setCode");isSerializable.execute("addAction",getJSON);isSerializable.execute("addAction",setJSON);isSerializable.execute("addAction",setCode);isSerializable.execute("addAction",getCode);isSerializable.execute("setName","Is serializable");getJSON.execute("setName","Marshall");setJSON.execute("setName","Unmarshall");this.rootType.execute("addBehavior",isSerializable);if(logs){logs.execute("setCode",function(json){return null})}isSerializable.execute("setCode",function(json){return null});hasTemplate.execute("setCode",function(json){return null});hasAlias.execute("setCode",function(json){return null});hasTemplate.execute("setCode",function(json){return null});hasBehaviors.execute("setCode",function(json){if(json){var behaviors=this.execute("listBehaviors");for(var k in json.behaviors){var bData=json.behaviors[k];if(behaviors==null||behaviors.has==null||!behaviors.has(bData)){var _behavior=this.execute("get",bData);this.execute("addBehavior",_behavior)}}}else{var _behaviors=this.execute("listBehaviors");if(_behaviors){return{id:"hasBehaviors",behaviors:_behaviors.toJSON()}}return null}});hasActions.execute("setCode",function(json){if(json){var actions=this.execute("listActions");for(var k in json.actions){var aData=json.actions[k];if(actions==null||actions.has==null||!actions.has(aData)){var _action=this.execute("get",aData);this.execute("addAction",_action)}}}else{var _actions=this.execute("listActions");if(_actions){return{id:"hasActions",actions:_actions.toJSON()}}return null}});isActionable.execute("setCode",function(json){if(json){if(json.code){this.execute("setCode",json.code)}if(json.topic){}if(json.method){}}else{var result=void 0;var setResult=function setResult(result,entryName,entryValue){if(entryValue){result=result||{id:"isActionable"};result[entryName]=entryValue}return result};var code=this.execute("getCode");result=setResult(result,"code",code);return result}});has.execute("setCode",function(json){if(json){}else{}});canBeA.execute("setCode",function(json){if(json){}else{}});isA.execute("setCode",function(json){var _this=this;if(json){var entityParentFound=false;var _iteratorNormalCompletion8=true;var _didIteratorError8=false;var _iteratorError8=undefined;try{for(var _iterator8=json.parents[Symbol.iterator](),_step8;!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=true){var parentId=_step8.value;if(parentId=="entity"){entityParentFound=true}var parent=this.execute("get",parentId);this.execute("addSuperType",parent)}}catch(err){_didIteratorError8=true;_iteratorError8=err}finally{try{if(!_iteratorNormalCompletion8&&_iterator8.return){_iterator8.return()}}finally{if(_didIteratorError8){throw _iteratorError8}}}if(!entityParentFound){this.execute("removeSuperType","entity")}}else{var _ret6=function(){var result=void 0;var setResult=function setResult(result,entryName,entryValue){if(entryValue){result=result||{id:"isA"};result[entryName]=entryValue}return result};var superTypes=_this.execute("listSuperTypes");var superTypeList=[];superTypes.forEach(function(value,key){superTypeList.push(value.id)});result=setResult(result,"parents",superTypeList);return{v:result}}();if((typeof _ret6==="undefined"?"undefined":_typeof(_ret6))==="object")return _ret6.v}});persistence.execute("setCode",function(json){if(json){var info=this.execute("getInfo");info=info?Object.assign(info,json.info):json.info}else{var result=void 0;var setResult=function setResult(result,entryName,entryValue){if(entryValue){result=result||{id:"persistence"};result[entryName]=entryValue}return result};var _info=this.execute("getInfo");result=setResult(result,"info",_info);return result}});isIdentifiable.execute("setCode",function(json){if(json){this.execute("setName",json.name)}else{var result=void 0;var setResult=function setResult(result,entryName,entryValue){if(entryValue){result=result||{id:"isIdentifiable"};result[entryName]=entryValue}return result};var name=this.execute("getName");result=setResult(result,"name",name);return result}});this.types.isSerializable=isSerializable}},{key:"createPresenter",value:function createPresenter(id,presenter,urlString){var _types9=this.types;var component=_types9.component;var url=_types9.url;var newPresenter=presenter.execute("new",id);var newUrl=url.execute("new",urlString);var newPresenterUrlUpdate=new BuildingBlockReference(newUrl,component,false,presenter,url);newPresenter.execute("updateReference",newPresenterUrlUpdate);return newPresenter}},{key:"overwritePresenter",value:function overwritePresenter(id,urlString,theEntity,baseEntity,baseReference,thePresenter){var overwrite=arguments.length<=6||arguments[6]===undefined?true:arguments[6];var _types10=this.types;var component=_types10.component;var system=_types10.system;var newPresenterList=baseReference.execute("new","list<"+id+">");var newPresenterListUpdate=newPresenterList.execute("newReference",component,false,baseEntity,baseReference);theEntity.execute("updateReference",newPresenterListUpdate);var newPresenter=this.createPresenter(id,thePresenter,urlString);if(overwrite){var newPresenterUpdate=newPresenter.execute("newReference",component,false,baseReference,thePresenter);newPresenterList.execute("updateReference",newPresenterUpdate)}else{var _newPresenterUpdate=newPresenter.execute("newReference",component);newPresenterList.execute("addReference",_newPresenterUpdate)}this.types[id]=newPresenter;this.types["list<"+id+">"]=newPresenterList;return newPresenter}},{key:"initPresentation",value:function initPresentation(){var _types11=this.types;var coreType=_types11.coreType;var behaviorType=_types11.behaviorType;var actionType=_types11.actionType;var entityType=_types11.entityType;var relationType=_types11.relationType;var referenceType=_types11.referenceType;var listType=_types11.listType;var hasBehaviors=_types11.hasBehaviors;var isA=_types11.isA;var has=_types11.has;var canBeA=_types11.canBeA;var isIdentifiable=_types11.isIdentifiable;var isSerializable=_types11.isSerializable;var hasActions=_types11.hasActions;var persistence=_types11.persistence;var canSearch=_types11.canSearch;var behavior=_types11.behavior;var component=_types11.component;var template=_types11.template;var system=_types11.system;var presenterType=coreType.execute("new","presenter");var url=entityType.execute("new","url");presenterType.execute("addReference",url,component);presenterType.execute("setName","Presenter Type");url.execute("setName","URL");listType.execute("setName","List Type");var presentersType=listType.execute("new","list<presenter>");var presenterUpdate=presenterType.execute("newReference",system,false,listType,template);presentersType.execute("updateReference",presenterUpdate);presentersType.execute("setName","Presenters type");var uiBasePresenters=presentersType.execute("new","rootList<presenter>");uiBasePresenters.execute("setName","UI Base Presenters");this.rootType.execute("addReference",uiBasePresenters,system);this.types.url=url;this.types.presenterType=presenterType;this.types.presenters=uiBasePresenters;var entityPresenter=this.createPresenter("entityPresenter",presenterType,"/ui/build/components/entities/entityPanel.js");var newPresenterUpdate=entityPresenter.execute("newReference",component);uiBasePresenters.execute("addReference",newPresenterUpdate);entityPresenter.execute("setName","Entity presenter");this.types.entityPresenter=entityPresenter;var inlineListPresenter=this.overwritePresenter("inlineListPresenter","/ui/build/components/entities/inlineListPanel.js",listType,this.rootType,uiBasePresenters,presenterType,false);inlineListPresenter.execute("setName","Inline list presenter");var inlineListPresenters=this.types["list<inlineListPresenter>"];inlineListPresenters.execute("setName","Inline list presenters");var behaviorPresenter=this.overwritePresenter("behaviorPresenter","/ui/build/components/entities/entityPanel.js",behaviorType,this.rootType,uiBasePresenters,presenterType,false);behaviorPresenter.execute("setName","Behavior presenter");var behaviorPresenters=this.types["list<behaviorPresenter>"];behaviorPresenters.execute("setName","Behavior presenters");var hasBehaviorsPresenter=this.overwritePresenter("hasBehaviorsPresenter","/ui/build/components/behaviors/hasBehaviorsPanel.js",hasBehaviors,behaviorType,behaviorPresenters,behaviorPresenter);hasBehaviorsPresenter.execute("setName","'has behaviors' presenter");var isAPresenter=this.overwritePresenter("isAPresenter","/ui/build/components/relations/isA.js",isA,behaviorType,behaviorPresenters,behaviorPresenter);isAPresenter.execute("setName","'is a' presenter");var hasPresenter=this.overwritePresenter("hasPresenter","/ui/build/components/relations/has.js",has,behaviorType,behaviorPresenters,behaviorPresenter);hasPresenter.execute("setName","'has presenter' presenter");var canBeAPresenter=this.overwritePresenter("canBeAPresenter","/ui/build/components/relations/canBeA.js",canBeA,behaviorType,behaviorPresenters,behaviorPresenter);canBeAPresenter.execute("setName","'can be a' presenter");var isIdentifiablePresenter=this.overwritePresenter("isIdentifiablePresenter","/ui/build/components/behaviors/isIdentifiablePanel.js",isIdentifiable,behaviorType,behaviorPresenters,behaviorPresenter);isIdentifiablePresenter.execute("setName","'is identifiable' presenter");var isSerializablePresenter=this.overwritePresenter("isSerializablePresenter","/ui/build/components/behaviors/isSerializablePanel.js",isSerializable,behaviorType,behaviorPresenters,behaviorPresenter);isSerializablePresenter.execute("setName","'is serializable' presenter");var hasPresentersPresenter=presenterType.execute("new","hasPresentersPresenter");hasPresentersPresenter.execute("setName","'has presenters' presenter");var hasActionsPresenter=this.overwritePresenter("hasActionsPresenter","/ui/build/components/behaviors/hasActionsPanel.js",hasActions,behaviorType,behaviorPresenters,behaviorPresenter);hasActionsPresenter.execute("setName","'has actions' presenter");var persistencePresenter=presenterType.execute("new","persistencePresenter");persistencePresenter.execute("setName","'persistence' presenter");var entityTypeRefs=entityType.execute("listReferences")}},{key:"initFinder",value:function initFinder(){var _types12=this.types;var behavior=_types12.behavior;var action=_types12.action;var entity=_types12.entity;var behaviorType=_types12.behaviorType;var behaviorPresenter=_types12.behaviorPresenter;var finder=entity.execute("new","finder");var canSearch=behavior.execute("new","canSearch");var applyFilter=action.execute("new","applyFilter");var applySort=action.execute("new","applySort");var setFilter=action.execute("new","setFilter");var getFilter=action.execute("new","getFilter");var setSort=action.execute("new","setSort");var getSort=action.execute("new","getSort");var setFilterLogic=action.execute("new","setFilterLogic");var getFilterLogic=action.execute("new","getFilterLogic");var setSortLogic=action.execute("new","setSortLogic");var getSortLogic=action.execute("new","getSortLogic");applyFilter.execute("setCode",function(instance){var filterLogic=this.data.get("filterLogic");return filterLogic.bind(this)(instance)});applySort.execute("setCode",function(instance){var sortLogic=this.data.get("sortLogic");sortLogic.bind(this)(instance)});setFilter.execute("setCode",function(filter){this.data.set("filter",filter)});getFilter.execute("setCode",function(){return this.data.get("filter")});setSort.execute("setCode",function(sort){this.data.set("sort",sort)});getSort.execute("setCode",function(){return this.data.get("sort")});setFilterLogic.execute("setCode",function(filterLogic){this.data.set("filterLogic",filterLogic)});getFilterLogic.execute("setCode",function(){return this.data.get("filterLogic")});setSortLogic.execute("setCode",function(sortLogic){this.data.set("sortLogic",sortLogic)});getSortLogic.execute("setCode",function(){return this.data.get("sortLogic")});canSearch.execute("setCode",function(json){if(json){this.execute("setFilter",json.filter);this.execute("setSort",json.sort);var _setFilterLogic=void 0,_setSortLogic=void 0;eval("setFilterLogic="+json.filterLogic);eval("setSortLogic="+json.filterLogic);this.execute("setFilterLogic",_setFilterLogic);this.execute("setSortLogic",_setSortLogic)}else{var result=void 0;var setResult=function setResult(result,entryName,entryValue){if(entryValue){result=result||{id:"canSearch"};result[entryName]=entryValue}return result};var filter=this.execute("getFilter");var sort=this.execute("getSort");var filterLogic=this.execute("getFilterLogic");var sortLogic=this.execute("getSortLogic");result=setResult(result,"filter",filter);result=setResult(result,"sort",sort);result=setResult(result,"filterLogic",filterLogic?utils.escapeFunctionCode(filterLogic):null);result=setResult(result,"sortLogic",sortLogic?utils.escapeFunctionCode(sortLogic):null);return result}});finder.execute("addBehavior",canSearch);finder.execute("setName","Finder");canSearch.execute("addAction",applyFilter);canSearch.execute("addAction",applySort);canSearch.execute("addAction",setFilter);canSearch.execute("addAction",getFilter);canSearch.execute("addAction",setSort);canSearch.execute("addAction",getSort);canSearch.execute("addAction",setFilterLogic);canSearch.execute("addAction",getFilterLogic);canSearch.execute("addAction",setSortLogic);canSearch.execute("addAction",getSortLogic);canSearch.execute("setName","Can search");var behaviorPresenters=this.types["list<behaviorPresenter>"];var canSearchPresenter=this.overwritePresenter("canSearchPresenter","/ui/build/components/behaviors/canSearchPanel.js",canSearch,behaviorType,behaviorPresenters,behaviorPresenter);canSearchPresenter.execute("setName","'Can search' presenter");var newFinder=finder.execute("new","newFinder");newFinder.execute("setName","New Finder");var hasFacets=behavior.execute("new","hasFacets");var listFacets=action.execute("new","listFacets");var clearFacets=action.execute("new","clearFacets");hasFacets.execute("setName","Has facets");listFacets.execute("setName","List facets");clearFacets.execute("setName","Clear facets");listFacets.execute("setCode",function(){return this.data.get("facets")});clearFacets.execute("setCode",function(){this.data.set("facets",null)});hasFacets.execute("setCode",function(json){if(json){}else{}});hasFacets.execute("addAction",listFacets);hasFacets.execute("addAction",clearFacets);newFinder.execute("addBehavior",hasFacets);newFinder.execute("setFilterLogic",function(instance){var foundInstance=true;var criteria=this.execute("getFilter");if(criteria.term&&criteria.term!="*"){var name=instance.execute("getName");if(name==null){name=instance.id}foundInstance=name&&name.toUpperCase().includes(criteria.term.toUpperCase())}if(foundInstance){var facets=this.data.get("facets");if(facets==null){facets=new BuildingBlockMap;this.data.set("facets",facets)}var rootType=instance.execute("getBaseType");var rootTypeName=rootType.execute("getName");facets.set(rootType.id,rootTypeName);if(criteria.parent&&criteria.parent!="*"){foundInstance=foundInstance&&rootType&&rootType.id==criteria.parent}}return foundInstance?instance:null});newFinder.execute("setSortLogic",function(instance){return null});this.types.hasFacets=hasFacets;this.types.canSearch=canSearch;this.types.newFinder=newFinder}},{key:"initConsoleLog",value:function initConsoleLog(){var _types13=this.types;var behaviorType=_types13.behaviorType;var actionType=_types13.actionType;var entityType=_types13.entityType;var entity=_types13.entity;var logs=behaviorType.execute("new","logs");this.rootType.execute("addBehavior",logs);this.types.logs=logs;var preExecute=actionType.execute("new","preExecute");preExecute.execute("setCode",function(params){var msg=this.id+".execute "+params.action;if(params.param){msg+=" "+(params.param.id?params.param.id:params.param)}console.log(msg);return true});var postExecute=actionType.execute("new","postExecute");postExecute.execute("setCode",function(params){var msg=this.id+".execute "+params.action;if(params.result){console.log(msg+" returned:");console.log(params.result)}return params.result});var errorExecute=actionType.execute("new","errorExecute");errorExecute.execute("setCode",function(params){var msg=this.id+".execute "+params.action;if(params.param){msg+=" "+(params.param.id?params.param.id:params.param)}msg+=" failed with: "+params.error;console.error(msg);return true});logs.execute("addAction",preExecute);logs.execute("addAction",postExecute);logs.execute("addAction",errorExecute)}},{key:"playground",value:function playground(){var _types14=this.types;var entityType=_types14.entityType;var entity=_types14.entity;var component=_types14.component;var system=_types14.system;var template=_types14.template;var list=_types14.list;var memberType1=entity.execute("new","memberType1");memberType1.execute("setName","Member Type 1");var memberType2=entity.execute("new","memberType2");memberType2.execute("setName","Member Type 2 ( testing long names for components as well)");var longName=entity.execute("new","longName");longName.execute("setName","Characterizations of multidimensionality in internationalization for counterrevolutionaries (to test extra long names)");longName.execute("addReference",memberType1,component);longName.execute("addReference",memberType2,component);var subLongName=longName.execute("new","testChildOflongName");var test1=entity.execute("new","test1");subLongName.execute("addReference",test1,component);var subSubLongName=subLongName.execute("new","testGrandChildOflongName");var list1=subLongName.execute("listReferences");var list2=subLongName.execute("listReferences",component);var list3=subSubLongName.execute("listReferences");var member1=memberType1.execute("new","member1");member1.execute("setName","Member 1");var memeber1Update=member1.execute("newReference",component,false,longName,memberType1);subLongName.execute("updateReference",memeber1Update);var list11=subLongName.execute("listReferences");var list21=subLongName.execute("listReferences",component);var list31=subSubLongName.execute("listReferences");var color=entity.execute("new","color");var red=color.execute("new","red");var blue=color.execute("new","blue");var colorList=list.execute("new","list<color>");var colorListTest=colorList.execute("listReferences");var colorUpdate=color.execute("newReference",system,false,list,template);colorList.execute("updateReference",colorUpdate);var colorList2=colorList.execute("new","colorList2");colorList2.execute("addReference",red,component);colorList2.execute("addReference",blue,component);var colorListTest2=colorList2.execute("listReferences");longName.execute("addReference",colorList,component);var colorList2Update=colorList2.execute("newReference",component,false,longName,colorList);subLongName.execute("updateReference",colorList2Update);var colorList2Alias=colorList2.execute("newAlias","colorList2Alias");var colorListTest3=colorList2Alias.execute("listReferences");var colorListTestName=colorList2Alias.execute("getName");colorList2Alias.execute("setName","Color list 2");var colorListTestName2=colorList2Alias.execute("getName")}},{key:"test",value:function test(){var _types15=this.types;var coreType=_types15.coreType;var behaviorType=_types15.behaviorType;var actionType=_types15.actionType;var entityType=_types15.entityType;var behavior=_types15.behavior;var action=_types15.action;var entity=_types15.entity;var hasBehaviors=_types15.hasBehaviors;var hasActions=_types15.hasActions;var isActionable=_types15.isActionable;var isIdentifiable=_types15.isIdentifiable;var isA=_types15.isA;var has=_types15.has;var canBeA=_types15.canBeA;var canSearch=_types15.canSearch;var persistence=_types15.persistence;var setCode=_types15.setCode;var getCode=_types15.getCode;var logs=_types15.logs;var listActions=_types15.listActions;var newFinder=_types15.newFinder;var a1=coreType.execute("listAllActions");var a2=behaviorType.execute("listAllActions");var a3=actionType.execute("listAllActions");var a4=entityType.execute("listAllActions");var a5=hasBehaviors.execute("listAllActions");var a6=hasActions.execute("listAllActions");var a7=isActionable.execute("listAllActions");var a8=listActions.execute("listAllActions");var b1=coreType.execute("listAllBehaviors");var b2=behaviorType.execute("listAllBehaviors");var b3=actionType.execute("listAllBehaviors");var b4=entityType.execute("listAllBehaviors");var b5=hasBehaviors.execute("listAllBehaviors");var b6=hasActions.execute("listAllBehaviors");var b7=isActionable.execute("listAllBehaviors");var b8=listActions.execute("listAllBehaviors");var newFinderJson=newFinder.execute("getJSON");var newFinderParsed=JSON.parse(newFinderJson);var rebuiltNewFinder=entity.execute("setJSON",newFinderParsed);var actionJson=action.execute("getJSON");var newAction=JSON.parse(actionJson);var rebuiltAction=entity.execute("setJSON",newAction);var jsonStr1="{\"id\":\"newFinderTwo\",\"behaviors\":[{\"id\":\"isA\",\"parents\":[\"finder\"]},{\"id\":\"isIdentifiable\",\"name\":\"New Finder\"},{\"id\":\"persistence\",\"info\":{\"createdOn\":1477521939093,\"location\":\"local\"}},{\"id\":\"canSearch\",\"filter\":{\"term\":\"Behavior\",\"parent\":\"actionType\"},\"sort\":{\"field\":\"name\"},\"filterLogic\":\"function (instance) {\\n                var foundInstance = true;\\n                var criteria = this.execute(\\\"getFilter\\\");\\n                if (criteria.term) {\\n                    var name = instance.execute(\\\"getName\\\");\\n                    foundInstance = foundInstance && name && name.includes(criteria.term);\\n                }\\n                if (criteria.parent) {\\n                    var parents = instance.execute(\\\"listSuperTypes\\\");\\n                    foundInstance = foundInstance && parents && parents.has(criteria.parent);\\n                }\\n                return foundInstance;\\n            }\",\"sortLogic\":\"function (instance) {\\n                return null;\\n            }\"}]}";var json1=JSON.parse(jsonStr1);newFinder.execute("setFilter",{term:"Behavior",parent:"actionType"});newFinder.execute("setSort",{field:"name"});var test=this.rootType.execute("listAllSubTypes",newFinder)}},{key:"root",get:function get(){return this.rootType}}]);return BuiltInBlocks}();exports.BuiltInBlocks=BuiltInBlocks;var CoreBuildingBlock=function(){function CoreBuildingBlock(){var id=arguments.length<=0||arguments[0]===undefined?".root":arguments[0];_classCallCheck(this,CoreBuildingBlock);this.id=id;this.data=new Map;var bootstrappEntity=BootstrappEntity.getInstance();bootstrappEntity.data[id]=this}_createClass(CoreBuildingBlock,[{key:"execute",value:function execute(action,param){var bootstrappEntity=BootstrappEntity.getInstance();for(var _len3=arguments.length,extraParams=Array(_len3>2?_len3-2:0),_key3=2;_key3<_len3;_key3++){extraParams[_key3-2]=arguments[_key3]}var params=extraParams&&extraParams.length?extraParams:null;return bootstrappEntity.execute.bind(this)(action,param,params)}}]);return CoreBuildingBlock}();var utils=function(){function utils(){_classCallCheck(this,utils)}_createClass(utils,null,[{key:"capitalize",value:function capitalize(str){return str.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()})}},{key:"escapeFunctionCode",value:function escapeFunctionCode(fn){var source=fn.toString();source=source.replace(/\\\n/g,"\\\n").replace(/\\'/g,"\\'").replace(/\\"/g,"\\\"").replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f");return source.replace(/[\u0000-\u0019]+/g,"")}}]);return utils}();
