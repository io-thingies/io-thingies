var exports = {}; "use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var D__0=React.createClass({_0_n:"D__0",getInitialState:function getInitialState(){return{_1_y:"no"}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps._1_y){this.setState({_1_y:"opening"})}},componentDidMount:function componentDidMount(){document.addEventListener("click",this._0_o);document.addEventListener("keydown",this._1_6)},componentWillUnmount:function componentWillUnmount(){document.removeEventListener("click",this._0_o);document.removeEventListener("keydown",this._1_6)},_1_6:function _1_6(event){if(event.keyCode==13||event.keyCode==27){this.close()}},_0_o:function _0_o(){if(this.state._1_y=="opening"){this.setState({_1_y:"open"})}else if(this.state._1_y=="open"){this.close()}},_0_q:function _0_q(e){},close:function close(){this.setState({_1_y:"no"});if(this.props.on_2_yChanged){this.props.on_2_yChanged(false)}},render:function render(){return this.state._1_y=="no"?null:React.createElement("div",{className:"dropdown-menu right visible",onClick:this._0_q,onKeyDown:this._1_6},this.props.children)}});exports.D__0=D__0;var E__1=React.createClass({_0_n:"E__1",render:function render(){var name=this.props.name;if(name!=null){var lockState=this.props.editMode?"save":"edit";var style=this.props.editMode?"c_et edit size":"c_et size";var size=Math.min(Math.max(name.length,10),100);return React.createElement("span",null,React.createElement("input",{type:"text",size:size,className:style,disabled:!this.props.editMode,placeholder:this.props.placeholder,value:name,onChange:this.props.onChange}),React.createElement("button",{className:"action2Btn",onClick:this.props.onEdit},React.createElement("i",{className:"fa fa-"+lockState+" fa-lg"})))}else{return null}}});exports.E__1=E__1;var E__0=React.createClass({_0_n:"E__0",browse:function browse(_0_4,className){if(this.props.onClick&&className=="active"){this.props.onClick(_0_4)}},render:function render(){var entity=this.props.data;var base=this.props.base;var enableLinks=base==null;if(entity!=null){var path=[];var _0_4s=entity.x0("_lan").toArray();while(_0_4s.length){var _0_4=_0_4s.pop();if(_0_4==base){enableLinks=true}var _0_4Name=_0_4.x0("getName")||React.createElement("i",null,"< ",_0_4.id," >");var className="el";if(_0_4s.length){if(this.props.type=="parents"&&enableLinks){className="active"}else{className="el"}}else{if(this.props.type=="parents"){className="el"}else{className="active"}}path.push(React.createElement("span",{className:className,key:_0_4.id,onClick:this.browse.bind(this,_0_4,className)},React.createElement("span",{className:"slash"},"/"),_0_4Name))}return React.createElement("span",{className:"path"},path)}else{return null}}});exports.E__0=E__0;var L__0=React.createClass({_0_n:"L__0",render:function render(){var content=this.props.children.length?this.props.children:React.createElement("span",null,"This entity has no ",this.props.title,".Click bellow to add one.");return React.createElement("div",{className:"c_lm"},React.createElement("div",{className:"head"},React.createElement("div",{className:"title"},this.props.title)),React.createElement("ul",{className:"list"},content),React.createElement("div",{className:"footer"},React.createElement("div",{className:"content"},"Add ",this.props.name)))}});exports.default=L__0;var M__0=React.createClass({_0_n:"M__0",select:function select(selected){if(this.props.onSelect){this.props.onSelect(selected)}},render:function render(){var menuTitle=React.createElement("span",null,this.props.data.title,": ");var selected=this.props.data.selected;var menuItems=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.props.data.list.keys()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var k=_step.value;var v=this.props.data.list.get(k);var className="";if(k==selected){className+=" selected"}if(this.props.type){className+=" "+this.props.type}var content=v.name;if(v.iconClass){content=React.createElement("i",{className:v.iconClass})}menuItems.push(React.createElement("span",{key:k,className:"menu-c_i0"+className,onClick:this.select.bind(this,k),title:v.name},content))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return React.createElement("div",{className:"",onClick:this._0_q},menuTitle,React.createElement("span",null,menuItems))}});exports.M__0=M__0;var M__1=React.createClass({_0_n:"M__1",handleClose:function handleClose(){if(this.props.onClose){this.props.onClose()}},_1_6:function _1_6(event){if(event.keyCode==13||event.keyCode==27){this.handleClose()}},render:function render(){return React.createElement("div",{className:"modal",onKeyDown:this._1_6},">",React.createElement("div",{className:"c_mc"},React.createElement("i",{className:"fa fa-close close",onClick:this.handleClose}),this.props.children))}});exports.M__1=M__1;var API="/api/entities";var _results={};var _changeListeners=[];var SA1={init:function init(){window._0_g=new exports.B__0;window._0_g.init();window.entity=window._0_g.types.entity},searchEntities2:function searchEntities2(term,type,sort,arrange,page){var newFinder=window._0_g.types.newFinder;newFinder.x0("setFilter",{term:term,parent:type});newFinder.x0("setSort",{field:sort});newFinder.x0("clearFacets");var results=window._0_g.root.x0("_lasbt",newFinder);var _0_u=newFinder.x0("listFacets");return{originalSearch:{term:term,type:type,sort:sort},count:results.size,entities:results,_0_u:_0_u}},getEntity2:function getEntity2(id){var results=window._0_g.root.x0("get",id);return results},unmarshallEntity:function unmarshallEntity(entityJson){return window.entity.x0("_sj",entityJson)},unmarshallOldEntity:function unmarshallOldEntity(entityJson){return window.entity.x0("_sj",entityJson)},resolveBehaviors:function resolveBehaviors(behaviors,callback){var result={};var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=behaviors[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var b=_step2.value;var bClass=window[b];if(bClass){result[b]=bClass}else{result[b]=null;console.error("Could not resolve: "+b)}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}callback(result)},searchType:function searchType(type,callback){var httpParams=SA1.buildParams({"term":"*","type":type,"sort":"createDate","arrange":false,"page":"*"});var self=this;_g_j(API+httpParams,function(err,res){var entities=[];var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=res.entities[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var e=_step3.value;entities.push(self.unmarshallEntity(e))}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}var result={entities:entities,count:res.count,pages:res.pages,originalSearch:res.originalSearch,_0_u:res._0_u};if(callback){callback(result)}})},searchEntities:function searchEntities(term,type,sort,arrange,page){var httpParams=SA1.buildParams({"term":term,"type":type,"sort":sort,"arrange":arrange,"page":page});var self=this;_g_j(API+httpParams,function(err,res){var entities=[];var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=res.entities[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var e=_step4.value;entities.push(self.unmarshallEntity(e))}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}var result={entities:entities,count:res.count,pages:res.pages,originalSearch:res.originalSearch,_0_u:res._0_u};_results=result;SA1.notifyChange()})},addEntity:function addEntity(entity,cb){postJSON(API,entity,function(res){if(cb)cb(res)})},removeEntity:function removeEntity(id,cb){deleteJSON(API+"/"+id,cb)},getCachedEntities:function getCachedEntities(){return _results},getEntity:function getEntity(id,cb){var self=this;_g_j(API+"/"+id,function(err,res){var entity=self.unmarshallOldEntity(res);if(cb)cb(entity)})},getEntities:function getEntities(ids,cb){var self=this;_g_j(API+"/["+ids.toString()+"]",function(err,res){var entityList=[];var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=res[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var r=_step5.value;entityList.push(self.unmarshallOldEntity(r))}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return()}}finally{if(_didIteratorError5){throw _iteratorError5}}}if(cb)cb(entityList)})},getComponents:function getComponents(comps,cb){var count=0;for(var key in comps){count++;var url=comps[key].url;util.loadJsComponent(url,key,function(res,key){comps[key].component=res;count--;if(cb&&count==0)cb(comps)})}},notifyChange:function notifyChange(){_changeListeners.forEach(function(listener){listener()})},addChangeListener:function addChangeListener(listener){_changeListeners.push(listener)},removeChangeListener:function removeChangeListener(listener){_changeListeners=_changeListeners.filter(function(l){return listener!==l})},buildParams:function buildParams(params){var httpParams="";for(var k in params){var v=params[k];if(v){if(httpParams==""){httpParams+="?"}httpParams+=k+"="+v+"&"}}return httpParams}};localStorage.token=localStorage.token||Date.now()*Math.random();function _g_j(url,cb){var req=new XMLHttpRequest;req.onload=function(){if(req.status===404){cb(new Error("not found"))}else{cb(null,JSON.parse(req.response))}};req.open("GET",url);req.setRequestHeader("authorization",localStorage.token);req.send()}function postJSON(url,obj,cb){var req=new XMLHttpRequest;req.onload=function(){cb(JSON.parse(req.response))};req.open("POST",url);req.setRequestHeader("Content-Type","application/json;charset=UTF-8");req.setRequestHeader("authorization",localStorage.token);req.send(JSON.stringify(obj))}function deleteJSON(url,cb){var req=new XMLHttpRequest;req.onload=cb;req.open("DELETE",url);req.setRequestHeader("authorization",localStorage.token);req.send()}exports.SA1=SA1;var T__0=React.createClass({_0_n:"T__0",propTypes:{selected:React.PropTypes.number,children:React.PropTypes.oneOfType([React.PropTypes.array,React.PropTypes.element]).isRequired},getInitialState:function getInitialState(){return{selected:this.props.selected||0,isMoreD__0Open:false,is_2_fD__0Open:false,more:[]}},componentDidMount:function componentDidMount(){this._1_c();window.addEventListener("resize",this._1_c)},componentDidUpdate:function componentDidUpdate(){this._1_c()},componentWillUnmount:function componentWillUnmount(){window.removeEventListener("resize",this._1_c)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.selected!=null&&nextProps.selected!=this.state.selected){this.setState({selected:nextProps.selected})}},_1_c:function _1_c(){var more=[];var thisElem=ReactDOM.findDOMNode(this);var moreEl=thisElem.children[0].children[1];var moreWidth=moreEl.offsetWidth;var tabsElems=thisElem.children[0].children[2];if(tabsElems.children.length==1){moreEl.style.visibility="hidden";return}var settingsEl=thisElem.children[0].children[0];var settingsPos=settingsEl.offsetLeft;for(var i=0;i<tabsElems.children.length;i++){var tabEl=tabsElems.children[i];if(!tabEl){break}var pos=tabEl.offsetLeft;var width=tabEl.offsetWidth;if(pos+width+moreWidth>settingsPos){more.push(tabEl.textContent);tabEl.style.visibility="hidden"}else{tabEl.style.visibility=""}}if(more.length!=this.state._2_1){moreEl.style.visibility=more.length>0?"":"hidden";var moreItems=[];for(var i in more){var m=more[i];moreItems.push(React.createElement("li",{className:"c_i0",key:m},m))}this.setState({"more":React.createElement("div",{className:"c_lm"},React.createElement("ul",{className:"list"},moreItems)),_2_1:moreItems.length,isMoreD__0Open:false,is_2_fD__0Open:false})}},_1_1:function _1_1(index,event){event.preventDefault();event.stopPropagation();this.setState({selected:index,isMoreD__0Open:false,is_2_fD__0Open:false});if(this.props._2_3){this.props._2_3(this.props.children[index].key,index)}},_1_1_2_f:function _1_1_2_f(e){this.setState({isMoreD__0Open:false,is_2_fD__0Open:!this.state.is_2_fD__0Open})},_1_1More:function _1_1More(i,props){this.setState({isMoreD__0Open:!this.state.isMoreD__0Open,is_2_fD__0Open:false})},_1_8:function _1_8(value){this.state.isMoreD__0Open=value},_1_d_2_y:function _1_d_2_y(value){this.state.is_2_fD__0Open=value},_1_kl:function _1_kl(i,props){},_render_2_f:function _render_2_f(){var settings_2_y=this.props.get_2_f?"":"hidden";return React.createElement("li",{className:"settings dropdown",title:"_2_f",style:{visibility:settings_2_y}},React.createElement("button",{type:"button",className:"button",onClick:this._1_1_2_f},React.createElement("i",{className:"fa fa-cog fa-lg"})),React.createElement(D__0,{_1_y:this.state.is_2_fD__0Open,on_2_yChanged:this._1_d_2_y,key:"signIn"},this.props.get_2_f?this.props.get_2_f(this.props):null))},_3_6:function _3_6(){function labels(child,index){var tabClass="c_i0"+(this.state.selected===index?" active":"");return child.props?React.createElement("li",{key:index,title:"",className:tabClass,onClick:this._1_1.bind(this,index)},child.props.label):null}return React.createElement("ul",{className:this.props.name+"-menu"},this._render_2_f(),React.createElement("li",{className:"more dropdown"},React.createElement("span",{className:"",onClick:this._1_1More},"More",React.createElement("i",{className:"fa fa-angle-down"})),React.createElement(D__0,{_1_y:this.state.isMoreD__0Open,on_2_yChanged:this._1_8,key:"signIn"},this.state.more?this.state.more:null)),React.createElement("ul",{className:"list",onClick:this._1_kl},this.props.children.map(labels.bind(this))))},_3_4:function _3_4(){if(!this.props.tabsOnly){var TabPanel=null;if(this.props.children&&this.state.selected!=undefined&&this.state.selected>=0&&this.state.selected<this.props.children.length&&this.props.children[this.state.selected]){var TabPanel=this.props.children[this.state.selected];if(TabPanel!=null){if(TabPanel.type==null){return React.createElement("div",{className:this.props.name+"c_c0"},React.createElement(TabPanel,TabPanel.props))}else{return React.createElement("div",{className:this.props.name+"c_c0"},TabPanel)}}}}},render:function render(){return React.createElement("div",{className:this.props.name},this._3_6(),this._3_4())}});exports.T__0=T__0;var T__1=React.createClass({_0_n:"T__1",getInitialState:function getInitialState(){return{_2_k:false,type:this.props.type,_2_r:"",browseMode:true}},componentWillMount:function componentWillMount(){var self=this},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.visible){this.browse(nextProps.type)}},_1_a:function _1_a(parent){this.browse(parent)},browse:function browse(type){var entities=type.x0("listSubTypes");this.setState({type:type,entities:entities,browseMode:true,_2_r:""})},_0_v:function _0_v(entity,emphasize){if(entity){var name=entity.x0("getName");if(name){if(emphasize){return React.createElement("strong",null,name)}else{return name}}else{return React.createElement("i",null,"< ",entity.id," > ")}}},handleSelectType:function handleSelectType(type){var shouldClose=true;if(this.props.onSelect){if(type){shouldClose=this.props.onSelect(type)}else{shouldClose=this.props.onSelect(this.state._2_r,this.state.type)}}if(shouldClose){this.handleClose()}else{var _2_r="";this.setState({_2_r:_2_r})}},selectType:function selectType(type){if(this.state.browseMode){this.handleSelectType(this.state.type)}else{this.handleSelectType(type)}},handleClose:function handleClose(){if(this.props.onClose){this.props.onClose()}var _2_r="";this.setState({_2_r:_2_r})},selectTerm:function selectTerm(_2_r){var results=void 0;if(_2_r){var newFinder=window._0_g.types.newFinder;newFinder.x0("setFilter",{term:_2_r});newFinder.x0("clearFacets");var entities=this.state.type.x0("_lasbt",newFinder);results={count:entities.size,entities:entities}}this.setState({_2_r:_2_r,results:results,browseMode:false})},handleTargetEntitySelect:function handleTargetEntitySelect(type){var _2_r=type.x0("getName")||type.id;this.selectTerm(_2_r)},_1_i:function _1_i(e){var _2_r=e.target.value;this.selectTerm(_2_r)},_0_f:function _0_f(value,itself){var name=this._0_v(value);var instances=value.x0("_lasbt");var newEntity=void 0;var instanceCount=void 0;if(instances&&instances.size){var instanceCountLabel=instances.size;instanceCountLabel+=instances.size>1?" instances":" instance";instanceCount=React.createElement("span",{className:"c_ib number e-type",title:instanceCountLabel},instances.size)}var namePlaceholder=React.createElement("span",{className:"aLink",onClick:this.browse.bind(this,value)},name);if(itself){namePlaceholder=name}var type=React.createElement("li",{className:"row size",key:value.id},React.createElement("div",{className:"main c_w2"},namePlaceholder),React.createElement("div",{className:"details"},React.createElement("span",{className:"counters"},instanceCount)));return type},render:function render(){var _this=this;if(this.props.visible){var _ret=function(){var type=_this._0_f(_this.state.type,true);var subTypes=[];if(_this.state.entities){_this.state.entities.forEach(function(value,key){var row=_this._0_f(value,false);subTypes.push(row)})}var results=[];var resultsCount=0;var searchButton="Search";var browseMode=_this.state.browseMode;var matchedEntity=void 0;if(_this.state.results){resultsCount=_this.state.results.count;searchButton="Create "+_this.state._2_r;_this.state.results.entities.forEach(function(value,key){var resultTypeLabel=_this._0_v(value);var resultTypeName=value.x0("getName");var resultTypeName2=resultTypeName?resultTypeName.toUpperCase():null;var _2_r=_this.state._2_r.trim().toUpperCase();if(_2_r==resultTypeName2||_2_r==value.id.toUpperCase()){matchedEntity=value;results.push(React.createElement("div",{key:value.id},React.createElement("strong",null,resultTypeLabel)));searchButton=React.createElement("span",null,"Select ",resultTypeLabel," ")}else{results.push(React.createElement("div",{key:value.id},React.createElement("span",{className:"aLink",onClick:_this.handleTargetEntitySelect.bind(_this,value)},resultTypeLabel)))}})}else{browseMode=true}var root=window._0_g.root;var typeName=_this.props.type&&_this.props.type.id!=root.id?_this._0_v(_this.props.type,true):"entity";var selectionName=_this._0_v(_this.state.type,true);searchButton=browseMode?React.createElement("span",null,"Select ",selectionName):searchButton;return{v:React.createElement(M__1,{onClose:_this.handleClose},React.createElement("div",{className:"c_mc-title"},"Provide the ",typeName," you want to add"),React.createElement("div",{className:"c_mcc_c2"},React.createElement("div",{className:"c_esf"},React.createElement("input",{type:"text",autoFocus:true,className:"entitySearchName",placeholder:"Entity name",value:_this.state._2_r,onChange:_this._1_i}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn",onClick:_this.selectType.bind(_this,matchedEntity)},searchButton))),React.createElement("div",{className:"c_bc"},React.createElement("div",{className:"title"},"Path: "),React.createElement("div",{className:"content"},React.createElement(E__0,{data:_this.state.type,base:_this.props.type,type:"parents",onClick:_this._1_a}))),browseMode?React.createElement("div",{className:"browse-types"},React.createElement("div",{className:"c_rl"},React.createElement("div",{className:"head strong"},type),React.createElement("ul",{className:"rows pos c_mc-height"},subTypes))):React.createElement("div",{className:"search-types"},React.createElement("div",{className:"c_rl"},React.createElement("div",{className:"head strong"},React.createElement("li",{className:"row size"},React.createElement("div",{className:"main c_w2"},selectionName," type containing '",_this.state._2_r,"'"),React.createElement("div",{className:"details"},React.createElement("span",{className:"counters"},React.createElement("span",{className:"c_ib number e-type"},resultsCount))))),React.createElement("ul",{className:"rows pos c_mc-height"},results),React.createElement("button",{className:"btn",onClick:_this.browse.bind(_this,_this.state.type)},"Back to ",selectionName)))))}}();if((typeof _ret==="undefined"?"undefined":_typeof(_ret))==="object")return _ret.v}else{return null}}});exports.T__1=T__1;var util={loadJsComponent:function loadJsComponent(componentUrl,key,onSuccess,onFail){var js=document.createElement("script");js.type="text/javascript";js.src=componentUrl;js.onload=function(){if(onSuccess)onSuccess(exports.default,key)};try{document.body.appendChild(js)}catch(e){if(onFail)onFail(e)}}};exports.util=util;
