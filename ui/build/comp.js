var exports = {}; "use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var Dd_0=React.createClass({displayName:"Dd_0",getInitialState:function getInitialState(){return{isOpen:"no"}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.isOpen){this.setState({isOpen:"opening"})}},componentDidMount:function componentDidMount(){document.addEventListener("click",this.dch2);document.addEventListener("keydown",this.hkd0)},componentWillUnmount:function componentWillUnmount(){document.removeEventListener("click",this.dch2);document.removeEventListener("keydown",this.hkd0)},hkd0:function hkd0(event){if(event.keyCode==13||event.keyCode==27){this.close()}},dch2:function dch2(){if(this.state.isOpen=="opening"){this.setState({isOpen:"open"})}else if(this.state.isOpen=="open"){this.close()}},c_d1ClickHandler:function c_d1ClickHandler(e){},close:function close(){this.setState({isOpen:"no"});if(this.props.onVisibilityChanged){this.props.onVisibilityChanged(false)}},render:function render(){return this.state.isOpen=="no"?null:React.createElement("div",{className:"c_dm right visible",onClick:this.c_d1ClickHandler,onKeyDown:this.hkd0},this.props.children)}});exports.Dd_0=Dd_0;var Et_0=React.createClass({displayName:"Et_0",render:function render(){var name=this.props.name;if(name!=null){var lockState=this.props.editMode?"save":"edit";var style=this.props.editMode?"c_et edit size":"c_et size";var size=Math.min(Math.max(name.length,10),100);return React.createElement("span",null,React.createElement("input",{type:"text",size:size,className:style,disabled:!this.props.editMode,placeholder:this.props.placeholder,value:name,onChange:this.props.onChange}),React.createElement("button",{className:"c_a2b",onClick:this.props.onEdit},React.createElement("i",{className:"fa fa-"+lockState+" fa-lg"})))}else{return null}}});exports.Et_0=Et_0;var EntityPath=React.createClass({displayName:"EntityPath",browse:function browse(_0_4,className){if(this.props.onClick&&className=="active"){this.props.onClick(_0_4)}},render:function render(){var entity=this.props.data;var base=this.props.base;var enableLinks=base==null;if(entity!=null){var path=[];var _0_4s=entity.x0("_lan").toArray();while(_0_4s.length){var _0_4=_0_4s.pop();if(_0_4==base){enableLinks=true}var _0_4Name=_0_4.x0("getName")||React.createElement("i",null,"< ",_0_4.id," >");var className="el";if(_0_4s.length){if(this.props.type=="parents"&&enableLinks){className="active"}else{className="el"}}else{if(this.props.type=="parents"){className="el"}else{className="active"}}path.push(React.createElement("span",{className:className,key:_0_4.id,onClick:this.browse.bind(this,_0_4,className)},React.createElement("span",{className:"slash"},"/"),_0_4Name))}return React.createElement("span",{className:"path"},path)}else{return null}}});exports.EntityPath=EntityPath;var Lm_0=React.createClass({displayName:"Lm_0",render:function render(){var content=this.props.children.length?this.props.children:React.createElement("span",null,"This entity has no ",this.props.title,".Click bellow to add one.");return React.createElement("div",{className:"c_lm"},React.createElement("div",{className:"head"},React.createElement("div",{className:"title"},this.props.title)),React.createElement("ul",{className:"list"},content),React.createElement("div",{className:"footer"},React.createElement("div",{className:"content"},"Add ",this.props.name)))}});exports.default=Lm_0;var Ms_0=React.createClass({displayName:"Ms_0",select:function select(selected){if(this.props.onSelect){this.props.onSelect(selected)}},render:function render(){var menT=React.createElement("span",null,this.props.data.title,": ");var selected=this.props.data.selected;var menI=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.props.data.list.keys()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var k=_step.value;var v=this.props.data.list.get(k);var className="";if(k==selected){className+=" selected"}if(this.props.type){className+=" "+this.props.type}var content=v.name;if(v.iconClass){content=React.createElement("i",{className:v.iconClass})}menI.push(React.createElement("span",{key:k,className:"c_mi"+className,onClick:this.select.bind(this,k),title:v.name},content))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return React.createElement("div",{className:"",onClick:this.c_d1ClickHandler},menT,React.createElement("span",null,menI))}});exports.Ms_0=Ms_0;var Md_0=React.createClass({displayName:"Md_0",hcls0:function hcls0(){if(this.props.onClose){this.props.onClose()}},hkd0:function hkd0(event){if(event.keyCode==13||event.keyCode==27){this.hcls0()}},render:function render(){return React.createElement("div",{className:"c_m1",onKeyDown:this.hkd0},">",React.createElement("div",{className:"c_mc"},React.createElement("i",{className:"fa fa-close close",onClick:this.hcls0}),this.props.children))}});exports.Md_0=Md_0;var API="/api/entities";var _results={};var _changeListeners=[];var Sa_0={init:function init(){window._0_g=new exports.B__0;window._0_g.init();window.entity=window._0_g.types.entity},s_e2:function s_e2(term,type,sort,arrange,page){var newFinder=window._0_g.types.newFinder;newFinder.x0("m_sf0",{term:term,parent:type});newFinder.x0("m_ss0",{field:sort});newFinder.x0("m_cf0");var results=window._0_g.root.x0("_lasbt",newFinder);var _0_u=newFinder.x0("m_lf0");return{originalSearch:{term:term,type:type,sort:sort},count:results.size,entities:results,_0_u:_0_u}},g_e2:function g_e2(id){var results=window._0_g.root.x0("get",id);return results},umrs:function umrs(entityJson){return window.entity.x0("_sj",entityJson)},mrse:function mrse(entityJson){return window.entity.x0("_sj",entityJson)},resB0:function resB0(behaviors,callback){var result={};var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=behaviors[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var b=_step2.value;var bClass=window[b];if(bClass){result[b]=bClass}else{result[b]=null;console.error("Could not resolve: "+b)}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}callback(result)},sT0:function sT0(type,callback){var httpParams=Sa_0.bldP({"term":"*","type":type,"sort":"createDate","arrange":false,"page":"*"});var self=this;_g_j(API+httpParams,function(err,res){var entities=[];var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=res.entities[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var e=_step3.value;entities.push(self.umrs(e))}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}var result={entities:entities,count:res.count,pages:res.pages,originalSearch:res.originalSearch,_0_u:res._0_u};if(callback){callback(result)}})},seare:function seare(term,type,sort,arrange,page){var httpParams=Sa_0.bldP({"term":term,"type":type,"sort":sort,"arrange":arrange,"page":page});var self=this;_g_j(API+httpParams,function(err,res){var entities=[];var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=res.entities[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var e=_step4.value;entities.push(self.umrs(e))}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}var result={entities:entities,count:res.count,pages:res.pages,originalSearch:res.originalSearch,_0_u:res._0_u};_results=result;Sa_0.notifyChange()})},addEntity:function addEntity(entity,cb){pstJs(API,entity,function(res){if(cb)cb(res)})},removeEntity:function removeEntity(id,cb){delJs(API+"/"+id,cb)},gcach:function gcach(){return _results},getEntity:function getEntity(id,cb){var self=this;_g_j(API+"/"+id,function(err,res){var entity=self.mrse(res);if(cb)cb(entity)})},getEntities:function getEntities(ids,cb){var self=this;_g_j(API+"/["+ids.toString()+"]",function(err,res){var entityList=[];var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=res[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var r=_step5.value;entityList.push(self.mrse(r))}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return()}}finally{if(_didIteratorError5){throw _iteratorError5}}}if(cb)cb(entityList)})},getComponents:function getComponents(comps,cb){var count=0;for(var key in comps){count++;var url=comps[key].url;util.ljsc(url,key,function(res,key){comps[key].component=res;count--;if(cb&&count==0)cb(comps)})}},notifyChange:function notifyChange(){_changeListeners.forEach(function(listener){listener()})},addChangeListener:function addChangeListener(listener){_changeListeners.push(listener)},removeChangeListener:function removeChangeListener(listener){_changeListeners=_changeListeners.filter(function(l){return listener!==l})},bldP:function bldP(params){var httpParams="";for(var k in params){var v=params[k];if(v){if(httpParams==""){httpParams+="?"}httpParams+=k+"="+v+"&"}}return httpParams}};localStorage.token=localStorage.token||Date.now()*Math.random();function _g_j(url,cb){var req=new XMLHttpRequest;req.onload=function(){if(req.status===404){cb(new Error("not found"))}else{cb(null,JSON.parse(req.response))}};req.open("GET",url);req.setRequestHeader("authorization",localStorage.token);req.send()}function pstJs(url,obj,cb){var req=new XMLHttpRequest;req.onload=function(){cb(JSON.parse(req.response))};req.open("POST",url);req.setRequestHeader("Content-Type","application/json;charset=UTF-8");req.setRequestHeader("authorization",localStorage.token);req.send(JSON.stringify(obj))}function delJs(url,cb){var req=new XMLHttpRequest;req.onload=cb;req.open("DELETE",url);req.setRequestHeader("authorization",localStorage.token);req.send()}exports.Sa_0=Sa_0;var Tb_0=React.createClass({displayName:"Tb_0",propTypes:{selected:React.PropTypes.number,children:React.PropTypes.oneOfType([React.PropTypes.array,React.PropTypes.element]).isRequired},getInitialState:function getInitialState(){return{selected:this.props.selected||0,isMoreDd_0Open:false,isSettingsDd_0Open:false,more:[]}},componentDidMount:function componentDidMount(){this.hresz();window.addEventListener("resize",this.hresz)},componentDidUpdate:function componentDidUpdate(){this.hresz()},componentWillUnmount:function componentWillUnmount(){window.removeEventListener("resize",this.hresz)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.selected!=null&&nextProps.selected!=this.state.selected){this.setState({selected:nextProps.selected})}},hresz:function hresz(){var more=[];var thisElem=ReactDOM.findDOMNode(this);var mrel=thisElem.children[0].children[1];var mwdt=mrel.offsetWidth;var tbel=thisElem.children[0].children[2];if(tbel.children.length==1){mrel.style.visibility="hidden";return}var setel=thisElem.children[0].children[0];var stpos=setel.offsetLeft;for(var i=0;i<tbel.children.length;i++){var tabEl=tbel.children[i];if(!tabEl){break}var pos=tabEl.offsetLeft;var width=tabEl.offsetWidth;if(pos+width+mwdt>stpos){more.push(tabEl.textContent);tabEl.style.visibility="hidden"}else{tabEl.style.visibility=""}}if(more.length!=this.state.moreSize){mrel.style.visibility=more.length>0?"":"hidden";var mrit=[];for(var i in more){var m=more[i];mrit.push(React.createElement("li",{className:"c_i0",key:m},m))}this.setState({"more":React.createElement("div",{className:"c_lm"},React.createElement("ul",{className:"list"},mrit)),moreSize:mrit.length,isMoreDd_0Open:false,isSettingsDd_0Open:false})}},hc2:function hc2(index,event){event.preventDefault();event.stopPropagation();this.setState({selected:index,isMoreDd_0Open:false,isSettingsDd_0Open:false});if(this.props.onTabChange){this.props.onTabChange(this.props.children[index].key,index)}},hcs0:function hcs0(e){this.setState({isMoreDd_0Open:false,isSettingsDd_0Open:!this.state.isSettingsDd_0Open})},hcm0:function hcm0(i,props){this.setState({isMoreDd_0Open:!this.state.isMoreDd_0Open,isSettingsDd_0Open:false})},hmv0:function hmv0(value){this.state.isMoreDd_0Open=value},hsv0:function hsv0(value){this.state.isSettingsDd_0Open=value},ht1:function ht1(i,props){},r_s2:function r_s2(){var settingsVisibility=this.props.getSettings?"":"hidden";return React.createElement("li",{className:"settings c_d1",title:"Settings",style:{visibility:settingsVisibility}},React.createElement("button",{type:"button",className:"button",onClick:this.hcs0},React.createElement("i",{className:"fa fa-cog fa-lg"})),React.createElement(Dd_0,{isOpen:this.state.isSettingsDd_0Open,onVisibilityChanged:this.hsv0,key:"signIn"},this.props.getSettings?this.props.getSettings(this.props):null))},r_t3:function r_t3(){function labels(child,index){var tabClass="c_i0"+(this.state.selected===index?" active":"");return child.props?React.createElement("li",{key:index,title:"",className:tabClass,onClick:this.hc2.bind(this,index)},child.props.label):null}return React.createElement("ul",{className:this.props.name+"c_m0"},this.r_s2(),React.createElement("li",{className:"more c_d1"},React.createElement("span",{className:"",onClick:this.hcm0},"More",React.createElement("i",{className:"fa fa-angle-down"})),React.createElement(Dd_0,{isOpen:this.state.isMoreDd_0Open,onVisibilityChanged:this.hmv0,key:"signIn"},this.state.more?this.state.more:null)),React.createElement("ul",{className:"list",onClick:this.ht1},this.props.children.map(labels.bind(this))))},r_c4:function r_c4(){if(!this.props.tabsOnly){var TabPanel=null;if(this.props.children&&this.state.selected!=undefined&&this.state.selected>=0&&this.state.selected<this.props.children.length&&this.props.children[this.state.selected]){var TabPanel=this.props.children[this.state.selected];if(TabPanel!=null){if(TabPanel.type==null){return React.createElement("div",{className:this.props.name+"c_c0"},React.createElement(TabPanel,TabPanel.props))}else{return React.createElement("div",{className:this.props.name+"c_c0"},TabPanel)}}}}},render:function render(){return React.createElement("div",{className:this.props.name},this.r_t3(),this.r_c4())}});exports.Tb_0=Tb_0;var Ts_0=React.createClass({displayName:"Ts_0",getInitialState:function getInitialState(){return{m_ss8:false,type:this.props.type,_2_r:"",browseMode:true}},componentWillMount:function componentWillMount(){var self=this},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.visible){this.browse(nextProps.type)}},h_pn:function h_pn(parent){this.browse(parent)},browse:function browse(type){var entities=type.x0("_lsbt");this.setState({type:type,entities:entities,browseMode:true,_2_r:""})},fn0:function fn0(entity,emph0){if(entity){var name=entity.x0("getName");if(name){if(emph0){return React.createElement("strong",null,name)}else{return name}}else{return React.createElement("i",null,"< ",entity.id," > ")}}},hst0:function hst0(type){var shouldClose=true;if(this.props.onSelect){if(type){shouldClose=this.props.onSelect(type)}else{shouldClose=this.props.onSelect(this.state._2_r,this.state.type)}}if(shouldClose){this.hcls0()}else{var _2_r="";this.setState({_2_r:_2_r})}},selTy:function selTy(type){if(this.state.browseMode){this.hst0(this.state.type)}else{this.hst0(type)}},hcls0:function hcls0(){if(this.props.onClose){this.props.onClose()}var _2_r="";this.setState({_2_r:_2_r})},selTr:function selTr(_2_r){var results=void 0;if(_2_r){var newFinder=window._0_g.types.newFinder;newFinder.x0("m_sf0",{term:_2_r});newFinder.x0("m_cf0");var entities=this.state.type.x0("_lasbt",newFinder);results={count:entities.size,entities:entities}}this.setState({_2_r:_2_r,results:results,browseMode:false})},htes:function htes(type){var _2_r=type.x0("getName")||type.id;this.selTr(_2_r)},htec:function htec(e){var _2_r=e.target.value;this.selTr(_2_r)},bldr:function bldr(value,itself){var name=this.fn0(value);var instances=value.x0("_lasbt");var newEntity=void 0;var instanceCount=void 0;if(instances&&instances.size){var instanceCountLabel=instances.size;instanceCountLabel+=instances.size>1?" instances":" instance";instanceCount=React.createElement("span",{className:"c_ib number e-type",title:instanceCountLabel},instances.size)}var namePlaceholder=React.createElement("span",{className:"aLink",onClick:this.browse.bind(this,value)},name);if(itself){namePlaceholder=name}var type=React.createElement("li",{className:"row size",key:value.id},React.createElement("div",{className:"main c_w2"},namePlaceholder),React.createElement("div",{className:"details"},React.createElement("span",{className:"counters"},instanceCount)));return type},render:function render(){var _this=this;if(this.props.visible){var _ret=function(){var type=_this.bldr(_this.state.type,true);var subTypes=[];if(_this.state.entities){_this.state.entities.forEach(function(value,key){var row=_this.bldr(value,false);subTypes.push(row)})}var results=[];var resultsCount=0;var srcBtn="Search";var browseMode=_this.state.browseMode;var matchedEntity=void 0;if(_this.state.results){resultsCount=_this.state.results.count;srcBtn="Create "+_this.state._2_r;_this.state.results.entities.forEach(function(value,key){var resultTypeLabel=_this.fn0(value);var resultTypeName=value.x0("getName");var resultTypeName2=resultTypeName?resultTypeName.toUpperCase():null;var _2_r=_this.state._2_r.trim().toUpperCase();if(_2_r==resultTypeName2||_2_r==value.id.toUpperCase()){matchedEntity=value;results.push(React.createElement("div",{key:value.id},React.createElement("strong",null,resultTypeLabel)));srcBtn=React.createElement("span",null,"Select ",resultTypeLabel," ")}else{results.push(React.createElement("div",{key:value.id},React.createElement("span",{className:"aLink",onClick:_this.htes.bind(_this,value)},resultTypeLabel)))}})}else{browseMode=true}var root=window._0_g.root;var typeName=_this.props.type&&_this.props.type.id!=root.id?_this.fn0(_this.props.type,true):"entity";var selNm=_this.fn0(_this.state.type,true);srcBtn=browseMode?React.createElement("span",null,"Select ",selNm):srcBtn;return{v:React.createElement(Md_0,{onClose:_this.hcls0},React.createElement("div",{className:"c_mcc_t1"},"Provide the ",typeName," you want to add"),React.createElement("div",{className:"c_mcc_c2"},React.createElement("div",{className:"c_esf"},React.createElement("input",{type:"text",autoFocus:true,className:"c_esn",placeholder:"Entity name",value:_this.state._2_r,onChange:_this.htec}),React.createElement("div",{className:"actions"},React.createElement("button",{className:"btn",onClick:_this.selTy.bind(_this,matchedEntity)},srcBtn))),React.createElement("div",{className:"c_bc"},React.createElement("div",{className:"title"},"Path: "),React.createElement("div",{className:"content"},React.createElement(EntityPath,{data:_this.state.type,base:_this.props.type,type:"parents",onClick:_this.h_pn}))),browseMode?React.createElement("div",{className:"c_bt"},React.createElement("div",{className:"c_rl"},React.createElement("div",{className:"head strong"},type),React.createElement("ul",{className:"rows pos c_mc-height"},subTypes))):React.createElement("div",{className:"search-types"},React.createElement("div",{className:"c_rl"},React.createElement("div",{className:"head strong"},React.createElement("li",{className:"row size"},React.createElement("div",{className:"main c_w2"},selNm," type containing '",_this.state._2_r,"'"),React.createElement("div",{className:"details"},React.createElement("span",{className:"counters"},React.createElement("span",{className:"c_ib number e-type"},resultsCount))))),React.createElement("ul",{className:"rows pos c_mc-height"},results),React.createElement("button",{className:"btn",onClick:_this.browse.bind(_this,_this.state.type)},"Back to ",selNm)))))}}();if((typeof _ret==="undefined"?"undefined":_typeof(_ret))==="object")return _ret.v}else{return null}}});exports.Ts_0=Ts_0;var util={ljsc:function ljsc(curl3,key,onSuccess,onFail){var js=document.createElement("script");js.type="text/javascript";js.src=curl3;js.onload=function(){if(onSuccess)onSuccess(exports.default,key)};try{document.body.appendChild(js)}catch(e){if(onFail)onFail(e)}}};exports.util=util;
