"use strict";Object.defineProperty(exports,"__esModule",{value:true});var inlineListPanel=React.createClass({displayName:"inlineListPanel",getInitialState:function getInitialState(){return{entitiesState:{},showSelector:false,selectorType:null}},formatName:function formatName(entity){return entity.execute("getName")||React.createElement("i",null,"< ",entity.id," > ")},handlePageNavigation:function handlePageNavigation(parent){var url="/entities/get/"+parent.id;this.props.router.push(url)},handleDetails:function handleDetails(entity){var entitiesState=this.state.entitiesState;if(entitiesState[entity.id]){delete entitiesState[entity.id]}else{entitiesState[entity.id]=true}this.setState({entitiesState:entitiesState})},showRefSelector:function showRefSelector(){this.showSelector("referenceType",this.referenceTypeSelected)},referenceTypeSelected:function referenceTypeSelected(param){var selectorType=window.builtInBlocks.root;var templateRef=this.props.data.entity.execute("getReference","template");if(templateRef){selectorType=templateRef}var selectorFn=this.referenceSelected;this.setState({showSelector:true,selectorType:selectorType,selectorFn:selectorFn,param:param})},createNew:function createNew(parent,entity){var entityName=entity;var id=entityName.replace(/\s/g,"");entity=parent.execute("new",id);entity.execute("setName",entityName);return entity},referenceSelected:function referenceSelected(entity,newType){if(newType){entity=this.createNew(this.state.selectorType,entity)}this.props.data.entity.execute("addReference",entity,this.state.param);return true},showSelector:function showSelector(type,selectorFn){var root=window.builtInBlocks.root;var selectorType=type?root.execute("get",type):root;this.setState({showSelector:true,selectorType:selectorType,selectorFn:selectorFn})},closeSelector:function closeSelector(){this.setState({showSelector:false})},deleteReference:function deleteReference(id){this.props.data.entity.execute("removeReference",id);var showSelector=this.state.showSelector;this.setState({showSelector:showSelector})},showUpdateSelector:function showUpdateSelector(value){var selectorType=value.baseReference;var param=void 0;if(selectorType==null){selectorType=value}else{param=value}var selectorFn=this.updatedReferenceSelected;this.setState({showSelector:true,selectorType:selectorType,selectorFn:selectorFn,param:param})},updatedReferenceSelected:function updatedReferenceSelected(entity,newType){if(newType){entity=this.createNew(this.state.selectorType,entity)}var baseReference=this.state.selectorType;if(this.state.param){this.props.data.entity.execute("removeReference",this.state.param.id)}var typeRef=baseReference.tag;var baseEntity=baseReference.baseEntity;var entityUpdate=entity.execute("newReference",typeRef,false,baseEntity,baseReference);this.props.data.entity.execute("updateReference",entityUpdate);return true},render:function render(){var _this=this;var listReferences=this.props.data.entity.execute("listReferences");var hasNodes=[];if(listReferences&&listReferences.size){(function(){var self=_this;listReferences.forEach(function(entity,key){var entityLabel="loading ..";var icon="fa fa-circle-o-notch fa-fw fa-spin";var entityAction=null;var extraInfo=null;var tag=null;if(entity){var entityName=self.formatName(entity);if(entityName){entityLabel=entityName;tag=self.formatName(entity.tag);icon="fa fa-fw";if(entity.inherited){icon="fa fa-chevron-circle-down";entityAction=self.props.readOnly==false?React.createElement("div",null,React.createElement("button",{className:"action-button"},React.createElement("i",{className:"fa fa-edit fa-fw blue"})," Select")):null;var baseEntityName=self.formatName(entity.baseEntity);extraInfo=React.createElement("div",null,"Inherited from: ",React.createElement("strong",null,baseEntityName))}else{entityAction=self.props.readOnly==false?React.createElement("div",null,React.createElement("button",{className:"action-button",onClick:self.deleteReference.bind(self,entity.id)},React.createElement("i",{className:"fa fa-remove fa-fw red"})," Remove"),React.createElement("button",{className:"action-button",onClick:self.showUpdateSelector.bind(self,entity)},React.createElement("i",{className:"fa fa-edit fa-fw blue"})," Select")):null;if(entity.baseReference){icon="fa fa-dot-circle-o";var baseReferenceName=self.formatName(entity.baseReference);var _baseEntityName=self.formatName(entity.baseEntity);extraInfo=React.createElement("div",null,"Overwrites: ",React.createElement("strong",null,baseReferenceName),"  from ",React.createElement("strong",null,_baseEntityName))}else{icon="fa fa-circle-o"}}}else{entityLabel="Error loading entity.";icon="fa fa-exclamation fa-fw fa-red";entityAction=React.createElement("button",{className:"report-rel"},React.createElement("i",{className:"fa fa-send fa-fw red"})," Report")}var details=self.props.data.details;var rowFooterVisible=details&&details=="show"||self.state.entitiesState[entity.id]?"show":"hide";hasNodes.push(React.createElement("div",{className:"row",key:key},React.createElement("span",{className:"rel-ref-name"},React.createElement("i",{className:icon,onClick:self.handleDetails.bind(self,entity)},"  "),entityLabel),React.createElement("span",{className:"details right"},entityAction),React.createElement("div",{className:"row-footer "+rowFooterVisible},"Path: ",React.createElement(EntityPath,{data:entity,onClick:self.handlePageNavigation}),React.createElement("div",null,"Tag: ",tag),extraInfo)))}})})()}return React.createElement("div",{className:"inline-panel-content"},React.createElement("div",{className:"row-list rel-rows"},React.createElement("div",{className:"rows"},hasNodes)),this.props.readOnly==false?React.createElement("div",{className:"add-new-container"},React.createElement("button",{className:"action-button",onClick:this.showRefSelector},React.createElement("i",{className:"fa fa-plus blue"})," Add to List")):null,React.createElement(TypeSelector,{visible:this.state.showSelector,onClose:this.closeSelector,onSelect:this.state.selectorFn,type:this.state.selectorType}))}});exports.default=inlineListPanel;